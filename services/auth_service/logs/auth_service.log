2024-12-22 03:11:21 | INFO | src.integrations.logging_client:__init__:10 - LoggingClient initialized for service: AuthService
2024-12-22 03:11:21 | INFO | src.app:on_startup:54 - Starting AuthService ...
2024-12-22 03:11:21 | INFO | src.db.database:init_db:36 - Database connection is OK
2024-12-22 03:11:21 | INFO | src.app:on_startup:57 - Migrations applied successfully
2024-12-22 03:11:39 | ERROR | src.api.middleware.auth_middleware:dispatch:40 - Auth error: Not authenticated
2024-12-22 03:11:39 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000001ECDC415580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2116875812480, name='Task-6'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001ECDC415620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 180
               │     └ 3
               └ <function _main at 0x000001ECD9EE96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 180
           │    └ <function BaseProcess._bootstrap at 0x000001ECD9DD39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=4792 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001ECD9DD2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=4792 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001ECD9E9B0B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4792 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4792 started>
    │    └ <function subprocess_started at 0x000001ECDC2E28E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=4792 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=792, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001ECDC428A70>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=792, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000001ECDC2E1D00>
           │       │   └ <uvicorn.server.Server object at 0x000001ECDC428A70>
           │       └ <function run at 0x000001ECDBB1F1A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001ECDC405000>
           │      └ <function Runner.run at 0x000001ECDBBD0B80>
           └ <asyncio.runners.Runner object at 0x000001ECDC2668D0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001ECDBBCE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001ECDC2668D0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001ECDBBCE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001ECDBBD0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001ECDBB0E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECDFA53E30>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECDF...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001ECDE474DA0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECDFA53E30>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECDF...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECDF...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECDF2EBBC0>
          └ <fastapi.applications.FastAPI object at 0x000001ECDE474DA0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECDC42D1C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECDFA99040>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECDF2EBBC0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECDC42D1C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECDFA990A0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECDFA99040>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECDFA7F6A0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECDFE7FFE0>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001E...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECDFA990A0>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001ECDFE7FFE0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECDFA7F6A0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=403, detail='Not authenticated')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001ECDFED4FE0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECDFE95440>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECDFA99070>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECDFA990A0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x000001ECDD360C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=403, detail='Not authenticated')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x000001ECDFACA260>
    └ <contextlib._GeneratorContextManager object at 0x000001ECDFECDA00>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECDFA7F740>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECDFECD9A0>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECDFA99070>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECDFA99070>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    raise e  # Блокируем доступ, возвращая ошибку клиенту

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 32, in dispatch
    credentials: Optional[HTTPAuthorizationCredentials] = await self.auth_scheme(request)
                 │        │                                     │    │           └ <starlette.middleware.base._CachedRequest object at 0x000001ECDFECD9A0>
                 │        │                                     │    └ <fastapi.security.http.HTTPBearer object at 0x000001ECDFA990D0>
                 │        │                                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECDFA99070>
                 │        └ <class 'fastapi.security.http.HTTPAuthorizationCredentials'>
                 └ typing.Optional

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\security\http.py", line 308, in __call__
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 403: Not authenticated
2024-12-22 03:11:44 | ERROR | src.api.middleware.auth_middleware:dispatch:40 - Auth error: Not authenticated
2024-12-22 03:11:44 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000001ECDC415580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2116875812480, name='Task-9'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001ECDC415620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 180
               │     └ 3
               └ <function _main at 0x000001ECD9EE96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 180
           │    └ <function BaseProcess._bootstrap at 0x000001ECD9DD39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=4792 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001ECD9DD2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=4792 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001ECD9E9B0B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4792 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4792 started>
    │    └ <function subprocess_started at 0x000001ECDC2E28E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=4792 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=792, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001ECDC428A70>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=792, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000001ECDC2E1D00>
           │       │   └ <uvicorn.server.Server object at 0x000001ECDC428A70>
           │       └ <function run at 0x000001ECDBB1F1A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001ECDC405000>
           │      └ <function Runner.run at 0x000001ECDBBD0B80>
           └ <asyncio.runners.Runner object at 0x000001ECDC2668D0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001ECDBBCE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001ECDC2668D0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001ECDBBCE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001ECDBBD0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001ECDBB0E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECDFA53E30>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECDF...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001ECDE474DA0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECDFA53E30>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECDF...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECDF...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECDF2EBBC0>
          └ <fastapi.applications.FastAPI object at 0x000001ECDE474DA0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECDFEEB420>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECDFA99040>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECDF2EBBC0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECDFEEB420>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECDFA990A0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECDFA99040>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECDFEEB1A0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECDFECF350>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001E...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECDFA990A0>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001ECDFECF350>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECDFEEB1A0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=403, detail='Not authenticated')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001ECDFF11C60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECDFEEB380>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECDFA99070>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECDFA990A0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x000001ECDD360C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=403, detail='Not authenticated')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x000001ECDFEE72A0>
    └ <contextlib._GeneratorContextManager object at 0x000001ECDFECF8F0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECDFE95260>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECDFECF890>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECDFA99070>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECDFA99070>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    raise e  # Блокируем доступ, возвращая ошибку клиенту

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 32, in dispatch
    credentials: Optional[HTTPAuthorizationCredentials] = await self.auth_scheme(request)
                 │        │                                     │    │           └ <starlette.middleware.base._CachedRequest object at 0x000001ECDFECF890>
                 │        │                                     │    └ <fastapi.security.http.HTTPBearer object at 0x000001ECDFA990D0>
                 │        │                                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECDFA99070>
                 │        └ <class 'fastapi.security.http.HTTPAuthorizationCredentials'>
                 └ typing.Optional

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\security\http.py", line 308, in __call__
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 403: Not authenticated
2024-12-22 03:11:51 | ERROR | src.api.middleware.auth_middleware:dispatch:40 - Auth error: Not authenticated
2024-12-22 03:11:51 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000001ECDC415580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2116875812096, name='Task-13'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001ECDC415620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 180
               │     └ 3
               └ <function _main at 0x000001ECD9EE96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 180
           │    └ <function BaseProcess._bootstrap at 0x000001ECD9DD39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=4792 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001ECD9DD2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=4792 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001ECD9E9B0B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4792 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4792 started>
    │    └ <function subprocess_started at 0x000001ECDC2E28E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=4792 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=792, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001ECDC428A70>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=792, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000001ECDC2E1D00>
           │       │   └ <uvicorn.server.Server object at 0x000001ECDC428A70>
           │       └ <function run at 0x000001ECDBB1F1A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001ECDC405000>
           │      └ <function Runner.run at 0x000001ECDBBD0B80>
           └ <asyncio.runners.Runner object at 0x000001ECDC2668D0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001ECDBBCE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001ECDC2668D0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001ECDBBCE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001ECDBBD0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001ECDBB0E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECDFA53E30>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECDF...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001ECDE474DA0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECDFA53E30>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECDF...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECDF...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECDF2EBBC0>
          └ <fastapi.applications.FastAPI object at 0x000001ECDE474DA0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECDFF11DA0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECDFA99040>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECDF2EBBC0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECDFF11DA0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECDFA990A0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECDFA99040>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECDFF11D00>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECDFFD02C0>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001E...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECDFA990A0>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001ECDFFD02C0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECDFF11D00>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=403, detail='Not authenticated')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001ECDFF12200>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECDFF11E40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECDFA99070>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECDFA990A0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x000001ECDD360C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=403, detail='Not authenticated')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x000001ECDFEE79F0>
    └ <contextlib._GeneratorContextManager object at 0x000001ECDFFD0890>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECDFEEB240>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECDFFD0830>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECDFA99070>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECDFA99070>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    raise e  # Блокируем доступ, возвращая ошибку клиенту

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 32, in dispatch
    credentials: Optional[HTTPAuthorizationCredentials] = await self.auth_scheme(request)
                 │        │                                     │    │           └ <starlette.middleware.base._CachedRequest object at 0x000001ECDFFD0830>
                 │        │                                     │    └ <fastapi.security.http.HTTPBearer object at 0x000001ECDFA990D0>
                 │        │                                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECDFA99070>
                 │        └ <class 'fastapi.security.http.HTTPAuthorizationCredentials'>
                 └ typing.Optional

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\security\http.py", line 308, in __call__
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 403: Not authenticated
2024-12-22 03:11:54 | ERROR | src.api.middleware.auth_middleware:dispatch:40 - Auth error: Not authenticated
2024-12-22 03:11:54 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000001ECDC415580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2116875812096, name='Task-16'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001ECDC415620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 180
               │     └ 3
               └ <function _main at 0x000001ECD9EE96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 180
           │    └ <function BaseProcess._bootstrap at 0x000001ECD9DD39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=4792 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001ECD9DD2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=4792 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001ECD9E9B0B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4792 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4792 started>
    │    └ <function subprocess_started at 0x000001ECDC2E28E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=4792 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=792, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001ECDC428A70>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=792, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000001ECDC2E1D00>
           │       │   └ <uvicorn.server.Server object at 0x000001ECDC428A70>
           │       └ <function run at 0x000001ECDBB1F1A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001ECDC405000>
           │      └ <function Runner.run at 0x000001ECDBBD0B80>
           └ <asyncio.runners.Runner object at 0x000001ECDC2668D0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001ECDBBCE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001ECDC2668D0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001ECDBBCE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001ECDBBD0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001ECDBB0E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECDFA53E30>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECDF...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001ECDE474DA0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECDFA53E30>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECDF...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECDF...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECDF2EBBC0>
          └ <fastapi.applications.FastAPI object at 0x000001ECDE474DA0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECDFF120C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECDFA99040>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECDF2EBBC0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECDFF120C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECDFA990A0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECDFA99040>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECDFF122A0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECDFFD1100>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001E...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECDFA990A0>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001ECDFFD1100>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECDFF122A0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=403, detail='Not authenticated')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001ECDFF11EE0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECDFF12520>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECDFA99070>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECDFA990A0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x000001ECDD360C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=403, detail='Not authenticated')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x000001ECDFFD41E0>
    └ <contextlib._GeneratorContextManager object at 0x000001ECDFFD16D0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECDFF128E0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECDFFD1670>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECDFA99070>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECDFA99070>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    raise e  # Блокируем доступ, возвращая ошибку клиенту

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 32, in dispatch
    credentials: Optional[HTTPAuthorizationCredentials] = await self.auth_scheme(request)
                 │        │                                     │    │           └ <starlette.middleware.base._CachedRequest object at 0x000001ECDFFD1670>
                 │        │                                     │    └ <fastapi.security.http.HTTPBearer object at 0x000001ECDFA990D0>
                 │        │                                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECDFA99070>
                 │        └ <class 'fastapi.security.http.HTTPAuthorizationCredentials'>
                 └ typing.Optional

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\security\http.py", line 308, in __call__
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 403: Not authenticated
2024-12-22 03:11:56 | ERROR | src.api.middleware.auth_middleware:dispatch:40 - Auth error: Not authenticated
2024-12-22 03:11:56 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000001ECDC415580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2116875812096, name='Task-19'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001ECDC415620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 180
               │     └ 3
               └ <function _main at 0x000001ECD9EE96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 180
           │    └ <function BaseProcess._bootstrap at 0x000001ECD9DD39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=4792 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001ECD9DD2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=4792 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001ECD9E9B0B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4792 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4792 started>
    │    └ <function subprocess_started at 0x000001ECDC2E28E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=4792 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=792, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001ECDC428A70>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=792, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000001ECDC2E1D00>
           │       │   └ <uvicorn.server.Server object at 0x000001ECDC428A70>
           │       └ <function run at 0x000001ECDBB1F1A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001ECDC405000>
           │      └ <function Runner.run at 0x000001ECDBBD0B80>
           └ <asyncio.runners.Runner object at 0x000001ECDC2668D0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001ECDBBCE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001ECDC2668D0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001ECDBBCE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001ECDBBD0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001ECDBB0E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECDFA53E30>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECDF...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001ECDE474DA0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECDFA53E30>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECDF...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECDF...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECDF2EBBC0>
          └ <fastapi.applications.FastAPI object at 0x000001ECDE474DA0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECDFED4FE0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECDFA99040>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECDF2EBBC0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECDFED4FE0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECDFA990A0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECDFA99040>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECDFA7F6A0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECDFECF200>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001E...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECDFA990A0>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001ECDFECF200>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECDFA7F6A0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=403, detail='Not authenticated')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001ECDFEEB240>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECDFA7F740>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECDFA99070>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECDFA990A0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x000001ECDD360C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=403, detail='Not authenticated')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x000001ECDFEE7E00>
    └ <contextlib._GeneratorContextManager object at 0x000001ECDFECF350>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECDFEEB100>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECDFECF7D0>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECDFA99070>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECDFA99070>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    raise e  # Блокируем доступ, возвращая ошибку клиенту

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 32, in dispatch
    credentials: Optional[HTTPAuthorizationCredentials] = await self.auth_scheme(request)
                 │        │                                     │    │           └ <starlette.middleware.base._CachedRequest object at 0x000001ECDFECF7D0>
                 │        │                                     │    └ <fastapi.security.http.HTTPBearer object at 0x000001ECDFA990D0>
                 │        │                                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECDFA99070>
                 │        └ <class 'fastapi.security.http.HTTPAuthorizationCredentials'>
                 └ typing.Optional

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\security\http.py", line 308, in __call__
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 403: Not authenticated
2024-12-22 08:51:44 | INFO | src.integrations.logging_client:__init__:10 - LoggingClient initialized for service: AuthService
2024-12-22 08:51:44 | INFO | src.app:on_startup:54 - Starting AuthService ...
2024-12-22 08:51:45 | INFO | src.db.database:init_db:36 - Database connection is OK
2024-12-22 08:51:45 | INFO | src.app:on_startup:57 - Migrations applied successfully
2024-12-22 08:52:00 | INFO | src.db.repositories.user_repository:create_user:22 - User created with email: testuser@example.com
2024-12-22 08:52:44 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000001ECC3E25580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2116466848000, name='Task-37'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001ECC3E25620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 348
               │     └ 3
               └ <function _main at 0x000001ECC18F96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 348
           │    └ <function BaseProcess._bootstrap at 0x000001ECC17E39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001ECC17E2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001ECC18AB0B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    └ <function subprocess_started at 0x000001ECC3CF28E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001ECC3E38B30>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000001ECC3CF1D00>
           │       │   └ <uvicorn.server.Server object at 0x000001ECC3E38B30>
           │       └ <function run at 0x000001ECC352F1A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001ECC3E15000>
           │      └ <function Runner.run at 0x000001ECC35E0B80>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001ECC35DE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001ECC35DE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001ECC35E0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001ECC351E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
          └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC7477560>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC7477560>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC74760C0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7946E70>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001E...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7946E70>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC74760C0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ AttributeError("'Settings' object has no attribute 'ACCESS_TOKEN_EXPIRE_MINUTES'")
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001ECC79EBEC0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC79EB060>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x000001ECC4D10C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [AttributeError("'Settings' object has no attribute 'ACCESS_TOKEN_EXPIRE_MI...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x000001ECC74CB2A0>
    └ <contextlib._GeneratorContextManager object at 0x000001ECC7947380>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC79EB1A0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7947110>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 29, in dispatch
    return await call_next(request)
                 │         └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7947110>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC79EB1A0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ AttributeError("'Settings' object has no attribute 'ACCESS_TOKEN_EXPIRE_MINUTES'")
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001ECC78DB7E0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC78DB1A0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001ECC7494B90>
          └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001ECC78DB7E0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC78DB1A0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001ECC7947C50>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001ECC7453D10>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001ECC7494B90>
          └ <function wrap_app_handling_exceptions at 0x000001ECC5E437E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001ECC78DB600>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC78DB1A0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001ECC7453D10>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001ECC78DB600>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC78DB1A0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001ECC7453D10>>
          └ <fastapi.routing.APIRouter object at 0x000001ECC7453D10>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001ECC78DB600>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC78DB1A0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │     └ <function Route.handle at 0x000001ECC5E64E00>
          └ APIRoute(path='/auth/login', name='login_user', methods=['POST'])
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001ECC78DB600>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC78DB1A0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001ECC744B240>
          └ APIRoute(path='/auth/login', name='login_user', methods=['POST'])
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001ECC78DB600>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC78DB1A0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001ECC79471D0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000001ECC78DB240>
          └ <function wrap_app_handling_exceptions at 0x000001ECC5E437E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001ECC74485E0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC78DB1A0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000001ECC78DB240>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000001ECC79471D0>
                     └ <function get_request_handler.<locals>.app at 0x000001ECC744B2E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000001ECC5E43060>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'session': <sqlalchemy.orm.session.AsyncSession object at 0x000001ECC7A0C6E0>, 'user_data': UserLoginRequest(email='testuser...
                 │         └ <function login_user at 0x000001ECC74494E0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=Body(Pydant...

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\routers\auth_router.py", line 28, in login_user
    tokens = await controller.login_user(user_data)
                   │          │          └ UserLoginRequest(email='testuser@example.com', password='SecurePassword123')
                   │          └ <function AuthController.login_user at 0x000001ECC6CFF420>
                   └ <src.api.controllers.auth_controller.AuthController object at 0x000001ECC7A0C710>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\controllers\auth_controller.py", line 34, in login_user
    tokens = create_jwt_tokens(user_id=user.id)
             │                         │    └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000001ECC6CFC860>
             │                         └ <src.db.models.user_model.User object at 0x000001ECC78BD490>
             └ <function create_jwt_tokens at 0x000001ECC6CFEB60>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\core\utils\security.py", line 16, in create_jwt_tokens
    access_expires = datetime.utcnow() + timedelta(minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES)
                     │        │          │                 └ Settings(SERVICE_NAME='AuthService', ENVIRONMENT='development', DEBUG=True, APP_PORT=8002, APP_HOST='0.0.0.0', API_VERSION='v...
                     │        │          └ <class 'datetime.timedelta'>
                     │        └ <method 'utcnow' of 'datetime.datetime' objects>
                     └ <class 'datetime.datetime'>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\pydantic\main.py", line 892, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
                                 │                                          └ 'ACCESS_TOKEN_EXPIRE_MINUTES'
                                 └ Settings(SERVICE_NAME='AuthService', ENVIRONMENT='development', DEBUG=True, APP_PORT=8002, APP_HOST='0.0.0.0', API_VERSION='v...

AttributeError: 'Settings' object has no attribute 'ACCESS_TOKEN_EXPIRE_MINUTES'
2024-12-22 08:52:44 | ERROR | src.api.middleware.auth_middleware:dispatch:40 - Auth error: Invalid token
2024-12-22 08:52:44 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000001ECC3E25580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2116466848000, name='Task-47'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001ECC3E25620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 348
               │     └ 3
               └ <function _main at 0x000001ECC18F96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 348
           │    └ <function BaseProcess._bootstrap at 0x000001ECC17E39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001ECC17E2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001ECC18AB0B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    └ <function subprocess_started at 0x000001ECC3CF28E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001ECC3E38B30>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000001ECC3CF1D00>
           │       │   └ <uvicorn.server.Server object at 0x000001ECC3E38B30>
           │       └ <function run at 0x000001ECC352F1A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001ECC3E15000>
           │      └ <function Runner.run at 0x000001ECC35E0B80>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001ECC35DE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001ECC35DE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001ECC35E0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001ECC351E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
          └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC78DB9C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC78DB9C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC79EB2E0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0D940>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001E...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0D940>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC79EB2E0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=401, detail='Invalid token')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001ECC8B27EC0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC79E8540>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x000001ECC4D10C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=401, detail='Invalid token')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x000001ECC7A73780>
    └ <contextlib._GeneratorContextManager object at 0x000001ECC7A0DF40>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC79E84A0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0DEE0>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    raise e  # Блокируем доступ, возвращая ошибку клиенту

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 34, in dispatch
    payload = self._verify_token(credentials)
              │    │             └ HTTPAuthorizationCredentials(scheme='Bearer', credentials='null')
              │    └ <function AuthMiddleware._verify_token at 0x000001ECC5FD62A0>
              └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 56, in _verify_token
    raise HTTPException(status_code=401, detail="Invalid token")
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 401: Invalid token
2024-12-22 08:52:44 | ERROR | src.api.middleware.auth_middleware:dispatch:40 - Auth error: Invalid token
2024-12-22 08:52:44 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000001ECC3E25580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2116466848000, name='Task-50'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001ECC3E25620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 348
               │     └ 3
               └ <function _main at 0x000001ECC18F96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 348
           │    └ <function BaseProcess._bootstrap at 0x000001ECC17E39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001ECC17E2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001ECC18AB0B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    └ <function subprocess_started at 0x000001ECC3CF28E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001ECC3E38B30>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000001ECC3CF1D00>
           │       │   └ <uvicorn.server.Server object at 0x000001ECC3E38B30>
           │       └ <function run at 0x000001ECC352F1A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001ECC3E15000>
           │      └ <function Runner.run at 0x000001ECC35E0B80>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001ECC35DE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001ECC35DE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001ECC35E0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001ECC351E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
          └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC8B58540>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC8B58540>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC8B58040>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0E600>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001E...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0E600>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC8B58040>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=401, detail='Invalid token')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001ECC8B585E0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC8B58360>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x000001ECC4D10C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=401, detail='Invalid token')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x000001ECC8B54450>
    └ <contextlib._GeneratorContextManager object at 0x000001ECC7A0EBD0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC8B58720>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0EB70>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    raise e  # Блокируем доступ, возвращая ошибку клиенту

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 34, in dispatch
    payload = self._verify_token(credentials)
              │    │             └ HTTPAuthorizationCredentials(scheme='Bearer', credentials='null')
              │    └ <function AuthMiddleware._verify_token at 0x000001ECC5FD62A0>
              └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 56, in _verify_token
    raise HTTPException(status_code=401, detail="Invalid token")
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 401: Invalid token
2024-12-22 08:52:44 | ERROR | src.api.middleware.auth_middleware:dispatch:40 - Auth error: Invalid token
2024-12-22 08:52:44 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000001ECC3E25580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2116466848000, name='Task-53'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001ECC3E25620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 348
               │     └ 3
               └ <function _main at 0x000001ECC18F96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 348
           │    └ <function BaseProcess._bootstrap at 0x000001ECC17E39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001ECC17E2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001ECC18AB0B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    └ <function subprocess_started at 0x000001ECC3CF28E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001ECC3E38B30>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000001ECC3CF1D00>
           │       │   └ <uvicorn.server.Server object at 0x000001ECC3E38B30>
           │       └ <function run at 0x000001ECC352F1A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001ECC3E15000>
           │      └ <function Runner.run at 0x000001ECC35E0B80>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001ECC35DE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001ECC35DE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001ECC35E0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001ECC351E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
          └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC8B587C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC8B587C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC8B589A0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0F320>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001E...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0F320>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC8B589A0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=401, detail='Invalid token')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001ECC8B58900>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC8B58AE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x000001ECC4D10C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=401, detail='Invalid token')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x000001ECC8B54BA0>
    └ <contextlib._GeneratorContextManager object at 0x000001ECC7A0F8F0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC8B58E00>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0F890>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    raise e  # Блокируем доступ, возвращая ошибку клиенту

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 34, in dispatch
    payload = self._verify_token(credentials)
              │    │             └ HTTPAuthorizationCredentials(scheme='Bearer', credentials='null')
              │    └ <function AuthMiddleware._verify_token at 0x000001ECC5FD62A0>
              └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 56, in _verify_token
    raise HTTPException(status_code=401, detail="Invalid token")
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 401: Invalid token
2024-12-22 08:52:44 | ERROR | src.api.middleware.auth_middleware:dispatch:40 - Auth error: Invalid token
2024-12-22 08:52:44 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000001ECC3E25580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2116466848000, name='Task-56'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001ECC3E25620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 348
               │     └ 3
               └ <function _main at 0x000001ECC18F96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 348
           │    └ <function BaseProcess._bootstrap at 0x000001ECC17E39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001ECC17E2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001ECC18AB0B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    └ <function subprocess_started at 0x000001ECC3CF28E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001ECC3E38B30>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000001ECC3CF1D00>
           │       │   └ <uvicorn.server.Server object at 0x000001ECC3E38B30>
           │       └ <function run at 0x000001ECC352F1A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001ECC3E15000>
           │      └ <function Runner.run at 0x000001ECC35E0B80>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001ECC35DE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001ECC35DE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001ECC35E0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001ECC351E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
          └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC8B27EC0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC8B27EC0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC8B27E20>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0FC80>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001E...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0FC80>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC8B27E20>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=401, detail='Invalid token')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001ECC79E8540>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC79E84A0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x000001ECC4D10C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=401, detail='Invalid token')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x000001ECC7A73780>
    └ <contextlib._GeneratorContextManager object at 0x000001ECC7A0DDC0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC8B59080>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0EBD0>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    raise e  # Блокируем доступ, возвращая ошибку клиенту

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 34, in dispatch
    payload = self._verify_token(credentials)
              │    │             └ HTTPAuthorizationCredentials(scheme='Bearer', credentials='null')
              │    └ <function AuthMiddleware._verify_token at 0x000001ECC5FD62A0>
              └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 56, in _verify_token
    raise HTTPException(status_code=401, detail="Invalid token")
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 401: Invalid token
2024-12-22 08:52:45 | ERROR | src.api.middleware.auth_middleware:dispatch:40 - Auth error: Invalid token
2024-12-22 08:52:45 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000001ECC3E25580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2116471619392, name='Task-59'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001ECC3E25620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 348
               │     └ 3
               └ <function _main at 0x000001ECC18F96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 348
           │    └ <function BaseProcess._bootstrap at 0x000001ECC17E39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001ECC17E2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001ECC18AB0B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    └ <function subprocess_started at 0x000001ECC3CF28E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001ECC3E38B30>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000001ECC3CF1D00>
           │       │   └ <uvicorn.server.Server object at 0x000001ECC3E38B30>
           │       └ <function run at 0x000001ECC352F1A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001ECC3E15000>
           │      └ <function Runner.run at 0x000001ECC35E0B80>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001ECC35DE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001ECC35DE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001ECC35E0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001ECC351E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
          └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC78DB9C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC78DB9C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC78DB6A0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0EC60>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001E...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0EC60>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC78DB6A0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=401, detail='Invalid token')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001ECC8B58180>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC8B59120>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x000001ECC4D10C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=401, detail='Invalid token')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x000001ECC8B55080>
    └ <contextlib._GeneratorContextManager object at 0x000001ECC7A0D940>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC8B58CC0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0E1B0>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    raise e  # Блокируем доступ, возвращая ошибку клиенту

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 34, in dispatch
    payload = self._verify_token(credentials)
              │    │             └ HTTPAuthorizationCredentials(scheme='Bearer', credentials='null')
              │    └ <function AuthMiddleware._verify_token at 0x000001ECC5FD62A0>
              └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 56, in _verify_token
    raise HTTPException(status_code=401, detail="Invalid token")
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 401: Invalid token
2024-12-22 08:52:45 | ERROR | src.api.middleware.auth_middleware:dispatch:40 - Auth error: Invalid token
2024-12-22 08:52:45 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000001ECC3E25580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2116471618432, name='Task-62'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001ECC3E25620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 348
               │     └ 3
               └ <function _main at 0x000001ECC18F96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 348
           │    └ <function BaseProcess._bootstrap at 0x000001ECC17E39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001ECC17E2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001ECC18AB0B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    └ <function subprocess_started at 0x000001ECC3CF28E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001ECC3E38B30>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000001ECC3CF1D00>
           │       │   └ <uvicorn.server.Server object at 0x000001ECC3E38B30>
           │       └ <function run at 0x000001ECC352F1A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001ECC3E15000>
           │      └ <function Runner.run at 0x000001ECC35E0B80>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001ECC35DE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001ECC35DE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001ECC35E0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001ECC351E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC8...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC8...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC8...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
          └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC8B58360>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC8B58360>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC8B585E0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC8B641D0>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001E...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001ECC8B641D0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC8B585E0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=401, detail='Invalid token')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001ECC8B58040>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC8B591C0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x000001ECC4D10C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=401, detail='Invalid token')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x000001ECC8B541E0>
    └ <contextlib._GeneratorContextManager object at 0x000001ECC8B647D0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC8B582C0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC8B64770>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    raise e  # Блокируем доступ, возвращая ошибку клиенту

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 34, in dispatch
    payload = self._verify_token(credentials)
              │    │             └ HTTPAuthorizationCredentials(scheme='Bearer', credentials='null')
              │    └ <function AuthMiddleware._verify_token at 0x000001ECC5FD62A0>
              └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 56, in _verify_token
    raise HTTPException(status_code=401, detail="Invalid token")
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 401: Invalid token
2024-12-22 08:52:58 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000001ECC3E25580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2116466851264, name='Task-76'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001ECC3E25620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 348
               │     └ 3
               └ <function _main at 0x000001ECC18F96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 348
           │    └ <function BaseProcess._bootstrap at 0x000001ECC17E39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001ECC17E2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001ECC18AB0B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    └ <function subprocess_started at 0x000001ECC3CF28E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001ECC3E38B30>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000001ECC3CF1D00>
           │       │   └ <uvicorn.server.Server object at 0x000001ECC3E38B30>
           │       └ <function run at 0x000001ECC352F1A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001ECC3E15000>
           │      └ <function Runner.run at 0x000001ECC35E0B80>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001ECC35DE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001ECC35DE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001ECC35E0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001ECC351E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
          └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC8B27E20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC8B27E20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC78DB740>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0D8E0>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001E...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0D8E0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC78DB740>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ AttributeError("'Settings' object has no attribute 'ACCESS_TOKEN_EXPIRE_MINUTES'")
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001ECC79E8540>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC78DAF20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x000001ECC4D10C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [AttributeError("'Settings' object has no attribute 'ACCESS_TOKEN_EXPIRE_MI...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x000001ECC7A73E00>
    └ <contextlib._GeneratorContextManager object at 0x000001ECC7A0E030>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC78DB2E0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0DB50>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 29, in dispatch
    return await call_next(request)
                 │         └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0DB50>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC78DB2E0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ AttributeError("'Settings' object has no attribute 'ACCESS_TOKEN_EXPIRE_MINUTES'")
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001ECC8B598A0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC8B59800>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001ECC7494B90>
          └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001ECC8B598A0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC8B59800>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001ECC7A0FE90>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001ECC7453D10>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001ECC7494B90>
          └ <function wrap_app_handling_exceptions at 0x000001ECC5E437E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001ECC8B59BC0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC8B59800>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001ECC7453D10>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001ECC8B59BC0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC8B59800>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001ECC7453D10>>
          └ <fastapi.routing.APIRouter object at 0x000001ECC7453D10>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001ECC8B59BC0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC8B59800>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │     └ <function Route.handle at 0x000001ECC5E64E00>
          └ APIRoute(path='/auth/login', name='login_user', methods=['POST'])
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001ECC8B59BC0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC8B59800>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001ECC744B240>
          └ APIRoute(path='/auth/login', name='login_user', methods=['POST'])
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001ECC8B59BC0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC8B59800>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001ECC7A0FBC0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000001ECC8B59760>
          └ <function wrap_app_handling_exceptions at 0x000001ECC5E437E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001ECC8B59D00>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC8B59800>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000001ECC8B59760>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000001ECC7A0FBC0>
                     └ <function get_request_handler.<locals>.app at 0x000001ECC744B2E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000001ECC5E43060>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'session': <sqlalchemy.orm.session.AsyncSession object at 0x000001ECC7947D10>, 'user_data': UserLoginRequest(email='testuser...
                 │         └ <function login_user at 0x000001ECC74494E0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=Body(Pydant...

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\routers\auth_router.py", line 28, in login_user
    tokens = await controller.login_user(user_data)
                   │          │          └ UserLoginRequest(email='testuser@example.com', password='SecurePassword123')
                   │          └ <function AuthController.login_user at 0x000001ECC6CFF420>
                   └ <src.api.controllers.auth_controller.AuthController object at 0x000001ECC7947530>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\controllers\auth_controller.py", line 34, in login_user
    tokens = create_jwt_tokens(user_id=user.id)
             │                         │    └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000001ECC6CFC860>
             │                         └ <src.db.models.user_model.User object at 0x000001ECC8B65970>
             └ <function create_jwt_tokens at 0x000001ECC6CFEB60>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\core\utils\security.py", line 16, in create_jwt_tokens
    access_expires = datetime.utcnow() + timedelta(minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES)
                     │        │          │                 └ Settings(SERVICE_NAME='AuthService', ENVIRONMENT='development', DEBUG=True, APP_PORT=8002, APP_HOST='0.0.0.0', API_VERSION='v...
                     │        │          └ <class 'datetime.timedelta'>
                     │        └ <method 'utcnow' of 'datetime.datetime' objects>
                     └ <class 'datetime.datetime'>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\pydantic\main.py", line 892, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
                                 │                                          └ 'ACCESS_TOKEN_EXPIRE_MINUTES'
                                 └ Settings(SERVICE_NAME='AuthService', ENVIRONMENT='development', DEBUG=True, APP_PORT=8002, APP_HOST='0.0.0.0', API_VERSION='v...

AttributeError: 'Settings' object has no attribute 'ACCESS_TOKEN_EXPIRE_MINUTES'
2024-12-22 08:52:58 | ERROR | src.api.middleware.auth_middleware:dispatch:40 - Auth error: Invalid token
2024-12-22 08:52:58 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000001ECC3E25580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2116466851264, name='Task-86'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001ECC3E25620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 348
               │     └ 3
               └ <function _main at 0x000001ECC18F96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 348
           │    └ <function BaseProcess._bootstrap at 0x000001ECC17E39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001ECC17E2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001ECC18AB0B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    └ <function subprocess_started at 0x000001ECC3CF28E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001ECC3E38B30>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000001ECC3CF1D00>
           │       │   └ <uvicorn.server.Server object at 0x000001ECC3E38B30>
           │       └ <function run at 0x000001ECC352F1A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001ECC3E15000>
           │      └ <function Runner.run at 0x000001ECC35E0B80>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001ECC35DE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001ECC35DE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001ECC35E0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001ECC351E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC8...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC8...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC8...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
          └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC79EB380>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC79EB380>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC8B58400>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC8B650D0>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001E...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001ECC8B650D0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC8B58400>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=401, detail='Invalid token')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001ECC8B5A480>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC8B591C0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x000001ECC4D10C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=401, detail='Invalid token')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x000001ECC8B560C0>
    └ <contextlib._GeneratorContextManager object at 0x000001ECC8B65B20>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC8B59940>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC8B657F0>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    raise e  # Блокируем доступ, возвращая ошибку клиенту

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 34, in dispatch
    payload = self._verify_token(credentials)
              │    │             └ HTTPAuthorizationCredentials(scheme='Bearer', credentials='null')
              │    └ <function AuthMiddleware._verify_token at 0x000001ECC5FD62A0>
              └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 56, in _verify_token
    raise HTTPException(status_code=401, detail="Invalid token")
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 401: Invalid token
2024-12-22 08:52:58 | ERROR | src.api.middleware.auth_middleware:dispatch:40 - Auth error: Invalid token
2024-12-22 08:52:58 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000001ECC3E25580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2116466851264, name='Task-89'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001ECC3E25620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 348
               │     └ 3
               └ <function _main at 0x000001ECC18F96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 348
           │    └ <function BaseProcess._bootstrap at 0x000001ECC17E39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001ECC17E2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001ECC18AB0B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    └ <function subprocess_started at 0x000001ECC3CF28E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001ECC3E38B30>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000001ECC3CF1D00>
           │       │   └ <uvicorn.server.Server object at 0x000001ECC3E38B30>
           │       └ <function run at 0x000001ECC352F1A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001ECC3E15000>
           │      └ <function Runner.run at 0x000001ECC35E0B80>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001ECC35DE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001ECC35DE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001ECC35E0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001ECC351E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC8...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC8...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC8...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
          └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC8B582C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC8B582C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC8B58040>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC8B64740>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001E...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001ECC8B64740>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC8B58040>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=401, detail='Invalid token')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001ECC8B585E0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC8B58720>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x000001ECC4D10C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=401, detail='Invalid token')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x000001ECC8B54FB0>
    └ <contextlib._GeneratorContextManager object at 0x000001ECC8B64830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC8B58CC0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC8B648C0>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    raise e  # Блокируем доступ, возвращая ошибку клиенту

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 34, in dispatch
    payload = self._verify_token(credentials)
              │    │             └ HTTPAuthorizationCredentials(scheme='Bearer', credentials='null')
              │    └ <function AuthMiddleware._verify_token at 0x000001ECC5FD62A0>
              └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 56, in _verify_token
    raise HTTPException(status_code=401, detail="Invalid token")
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 401: Invalid token
2024-12-22 08:52:58 | ERROR | src.api.middleware.auth_middleware:dispatch:40 - Auth error: Invalid token
2024-12-22 08:52:58 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000001ECC3E25580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2116466851264, name='Task-92'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001ECC3E25620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 348
               │     └ 3
               └ <function _main at 0x000001ECC18F96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 348
           │    └ <function BaseProcess._bootstrap at 0x000001ECC17E39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001ECC17E2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001ECC18AB0B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    └ <function subprocess_started at 0x000001ECC3CF28E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001ECC3E38B30>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000001ECC3CF1D00>
           │       │   └ <uvicorn.server.Server object at 0x000001ECC3E38B30>
           │       └ <function run at 0x000001ECC352F1A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001ECC3E15000>
           │      └ <function Runner.run at 0x000001ECC35E0B80>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001ECC35DE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001ECC35DE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001ECC35E0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001ECC351E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
          └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC79EB380>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC79EB380>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC79EB2E0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0D760>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001E...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0D760>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC79EB2E0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=401, detail='Invalid token')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001ECC79E87C0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC79E84A0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x000001ECC4D10C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=401, detail='Invalid token')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x000001ECC7A73780>
    └ <contextlib._GeneratorContextManager object at 0x000001ECC7A0DF70>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC74485E0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0DEB0>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    raise e  # Блокируем доступ, возвращая ошибку клиенту

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 34, in dispatch
    payload = self._verify_token(credentials)
              │    │             └ HTTPAuthorizationCredentials(scheme='Bearer', credentials='null')
              │    └ <function AuthMiddleware._verify_token at 0x000001ECC5FD62A0>
              └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 56, in _verify_token
    raise HTTPException(status_code=401, detail="Invalid token")
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 401: Invalid token
2024-12-22 08:52:58 | ERROR | src.api.middleware.auth_middleware:dispatch:40 - Auth error: Invalid token
2024-12-22 08:52:58 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000001ECC3E25580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2116466851264, name='Task-95'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001ECC3E25620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 348
               │     └ 3
               └ <function _main at 0x000001ECC18F96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 348
           │    └ <function BaseProcess._bootstrap at 0x000001ECC17E39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001ECC17E2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001ECC18AB0B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    └ <function subprocess_started at 0x000001ECC3CF28E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001ECC3E38B30>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000001ECC3CF1D00>
           │       │   └ <uvicorn.server.Server object at 0x000001ECC3E38B30>
           │       └ <function run at 0x000001ECC352F1A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001ECC3E15000>
           │      └ <function Runner.run at 0x000001ECC35E0B80>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001ECC35DE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001ECC35DE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001ECC35E0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001ECC351E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
          └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC79EB060>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC79EB060>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC79EBEC0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0D9D0>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001E...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0D9D0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC79EBEC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=401, detail='Invalid token')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001ECC78DB9C0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC79EB100>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x000001ECC4D10C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=401, detail='Invalid token')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x000001ECC7A73510>
    └ <contextlib._GeneratorContextManager object at 0x000001ECC7A0F020>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC78DB2E0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0F470>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    raise e  # Блокируем доступ, возвращая ошибку клиенту

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 34, in dispatch
    payload = self._verify_token(credentials)
              │    │             └ HTTPAuthorizationCredentials(scheme='Bearer', credentials='null')
              │    └ <function AuthMiddleware._verify_token at 0x000001ECC5FD62A0>
              └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 56, in _verify_token
    raise HTTPException(status_code=401, detail="Invalid token")
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 401: Invalid token
2024-12-22 08:52:58 | ERROR | src.api.middleware.auth_middleware:dispatch:40 - Auth error: Invalid token
2024-12-22 08:52:58 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000001ECC3E25580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2116466851264, name='Task-98'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001ECC3E25620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 348
               │     └ 3
               └ <function _main at 0x000001ECC18F96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 348
           │    └ <function BaseProcess._bootstrap at 0x000001ECC17E39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001ECC17E2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001ECC18AB0B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    └ <function subprocess_started at 0x000001ECC3CF28E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001ECC3E38B30>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000001ECC3CF1D00>
           │       │   └ <uvicorn.server.Server object at 0x000001ECC3E38B30>
           │       └ <function run at 0x000001ECC352F1A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001ECC3E15000>
           │      └ <function Runner.run at 0x000001ECC35E0B80>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001ECC35DE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001ECC35DE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001ECC35E0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001ECC351E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
          └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC78DB740>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC78DB740>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC78DAF20>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0F3B0>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001E...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0F3B0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC78DAF20>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=401, detail='Invalid token')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001ECC78DB380>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC78DB1A0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x000001ECC4D10C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=401, detail='Invalid token')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x000001ECC79C13C0>
    └ <contextlib._GeneratorContextManager object at 0x000001ECC7A0D160>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC78DB6A0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7A0C8C0>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    raise e  # Блокируем доступ, возвращая ошибку клиенту

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 34, in dispatch
    payload = self._verify_token(credentials)
              │    │             └ HTTPAuthorizationCredentials(scheme='Bearer', credentials='null')
              │    └ <function AuthMiddleware._verify_token at 0x000001ECC5FD62A0>
              └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 56, in _verify_token
    raise HTTPException(status_code=401, detail="Invalid token")
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 401: Invalid token
2024-12-22 08:52:58 | ERROR | src.api.middleware.auth_middleware:dispatch:40 - Auth error: Invalid token
2024-12-22 08:52:58 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000001ECC3E25580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2116466851264, name='Task-101'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001ECC3E25620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 348
               │     └ 3
               └ <function _main at 0x000001ECC18F96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 348
           │    └ <function BaseProcess._bootstrap at 0x000001ECC17E39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001ECC17E2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001ECC18AB0B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
    │    └ <function subprocess_started at 0x000001ECC3CF28E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=20436 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001ECC3E38B30>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000001ECC3CF1D00>
           │       │   └ <uvicorn.server.Server object at 0x000001ECC3E38B30>
           │       └ <function run at 0x000001ECC352F1A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001ECC3E15000>
           │      └ <function Runner.run at 0x000001ECC35E0B80>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001ECC35DE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001ECC1883B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001ECC35DE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001ECC35E0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001ECC351E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001ECC361B830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001ECC7...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
          └ <fastapi.applications.FastAPI object at 0x000001ECC5F37F20>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC78DB600>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001ECC7494C80>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001ECC78DB600>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001ECC7494C50>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC78891C0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC79472C0>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001E...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001ECC79472C0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC78891C0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=401, detail='Invalid token')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001ECC74774C0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001ECC74760C0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000001ECC7494B60>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x000001ECC4D10C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=401, detail='Invalid token')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x000001ECC78DC450>
    └ <contextlib._GeneratorContextManager object at 0x000001ECC7947EC0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001ECC7A00E00>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001ECC7947CE0>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    raise e  # Блокируем доступ, возвращая ошибку клиенту

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 34, in dispatch
    payload = self._verify_token(credentials)
              │    │             └ HTTPAuthorizationCredentials(scheme='Bearer', credentials='null')
              │    └ <function AuthMiddleware._verify_token at 0x000001ECC5FD62A0>
              └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000001ECC7494BC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 56, in _verify_token
    raise HTTPException(status_code=401, detail="Invalid token")
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 401: Invalid token
2024-12-22 08:58:51 | INFO | src.app:on_shutdown:62 - Shutting down AuthService ...
2024-12-22 09:00:17 | INFO | src.integrations.logging_client:__init__:10 - LoggingClient initialized for service: AuthService
2024-12-22 09:00:17 | INFO | src.app:on_startup:54 - Starting AuthService ...
2024-12-22 09:00:17 | INFO | src.db.database:init_db:36 - Database connection is OK
2024-12-22 09:00:17 | INFO | src.app:on_startup:57 - Migrations applied successfully
2024-12-22 09:04:41 | INFO | src.db.repositories.user_repository:create_user:22 - User created with email: testuser@example.com
2024-12-22 09:04:41 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x0000021A76E25580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2312742908160, name='Task-15'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x0000021A76E25620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 356
               │     └ 3
               └ <function _main at 0x0000021A748E96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 356
           │    └ <function BaseProcess._bootstrap at 0x0000021A747D39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000021A747D2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000021A7489B0B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
    │    └ <function subprocess_started at 0x0000021A76CF28E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=744, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000021A76E38B30>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=744, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x0000021A76CF1D00>
           │       │   └ <uvicorn.server.Server object at 0x0000021A76E38B30>
           │       └ <function run at 0x0000021A7645F1A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000021A76E15000>
           │      └ <function Runner.run at 0x0000021A765E0B80>
           └ <asyncio.runners.Runner object at 0x0000021A74873B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000021A765DE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000021A74873B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000021A765DE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000021A765E0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000021A7644E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000021A7A3ED8B0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021A7A...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000021A77B209E0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000021A7A3ED8B0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021A7A...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021A7A...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000021A7A3C0CE0>
          └ <fastapi.applications.FastAPI object at 0x0000021A77B209E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000021A7A3E6A20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000021A7A404D10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000021A7A3C0CE0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000021A7A3E6A20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021A7A404CB0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000021A7A404D10>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000021A7A3E74C0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000021A7A81F980>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021A7A404CB0>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x0000021A7A81F980>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000021A7A3E74C0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ AttributeError("'Settings' object has no attribute 'ACCESS_TOKEN_EXPIRE_MINUTES'")
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000021A7A87B4C0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021A7A823420>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021A7A404CB0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x0000021A77D10C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [AttributeError("'Settings' object has no attribute 'ACCESS_TOKEN_EXPIRE_MI...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x0000021A7A439FF0>
    └ <contextlib._GeneratorContextManager object at 0x0000021A7A865100>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000021A7A87B2E0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000021A7A864FE0>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 29, in dispatch
    return await call_next(request)
                 │         └ <starlette.middleware.base._CachedRequest object at 0x0000021A7A864FE0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000021A7A87B2E0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ AttributeError("'Settings' object has no attribute 'ACCESS_TOKEN_EXPIRE_MINUTES'")
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000021A7A87AE80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021A7A87B420>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000021A76A90260>
          └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000021A7A87AE80>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021A7A87B420>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000021A7A865A90>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000021A7A3C3EC0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000021A76A90260>
          └ <function wrap_app_handling_exceptions at 0x0000021A78E437E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000021A7A87B7E0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021A7A87B420>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000021A7A3C3EC0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000021A7A87B7E0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021A7A87B420>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000021A7A3C3EC0>>
          └ <fastapi.routing.APIRouter object at 0x0000021A7A3C3EC0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000021A7A87B7E0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021A7A87B420>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │     └ <function Route.handle at 0x0000021A78E64E00>
          └ APIRoute(path='/auth/login', name='login_user', methods=['POST'])
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000021A7A87B7E0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021A7A87B420>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000021A7A3BB240>
          └ APIRoute(path='/auth/login', name='login_user', methods=['POST'])
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000021A7A87B7E0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021A7A87B420>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000021A7A865610>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000021A7A87B880>
          └ <function wrap_app_handling_exceptions at 0x0000021A78E437E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000021A7A87BEC0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021A7A87B420>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000021A7A87B880>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000021A7A865610>
                     └ <function get_request_handler.<locals>.app at 0x0000021A7A3BB2E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000021A78E43060>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'session': <sqlalchemy.orm.session.AsyncSession object at 0x0000021A7A8EB1D0>, 'user_data': UserLoginRequest(email='testuser...
                 │         └ <function login_user at 0x0000021A7A3B94E0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=Body(Pydant...

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\routers\auth_router.py", line 28, in login_user
    tokens = await controller.login_user(user_data)
                   │          │          └ UserLoginRequest(email='testuser@example.com', password='SecurePassword123')
                   │          └ <function AuthController.login_user at 0x0000021A79C5F420>
                   └ <src.api.controllers.auth_controller.AuthController object at 0x0000021A7A8EB200>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\controllers\auth_controller.py", line 34, in login_user
    tokens = create_jwt_tokens(user_id=user.id)
             │                         │    └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x0000021A79C5C860>
             │                         └ <src.db.models.user_model.User object at 0x0000021A7A9AC1D0>
             └ <function create_jwt_tokens at 0x0000021A79C5EB60>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\core\utils\security.py", line 16, in create_jwt_tokens
    access_expires = datetime.utcnow() + timedelta(minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES)
                     │        │          │                 └ Settings(SERVICE_NAME='AuthService', ENVIRONMENT='development', DEBUG=True, APP_PORT=8002, APP_HOST='0.0.0.0', API_VERSION='v...
                     │        │          └ <class 'datetime.timedelta'>
                     │        └ <method 'utcnow' of 'datetime.datetime' objects>
                     └ <class 'datetime.datetime'>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\pydantic\main.py", line 892, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
                                 │                                          └ 'ACCESS_TOKEN_EXPIRE_MINUTES'
                                 └ Settings(SERVICE_NAME='AuthService', ENVIRONMENT='development', DEBUG=True, APP_PORT=8002, APP_HOST='0.0.0.0', API_VERSION='v...

AttributeError: 'Settings' object has no attribute 'ACCESS_TOKEN_EXPIRE_MINUTES'
2024-12-22 09:04:41 | ERROR | src.api.middleware.auth_middleware:dispatch:40 - Auth error: Invalid token
2024-12-22 09:04:41 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x0000021A76E25580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2312742908160, name='Task-25'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x0000021A76E25620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 356
               │     └ 3
               └ <function _main at 0x0000021A748E96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 356
           │    └ <function BaseProcess._bootstrap at 0x0000021A747D39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000021A747D2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000021A7489B0B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
    │    └ <function subprocess_started at 0x0000021A76CF28E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=744, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000021A76E38B30>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=744, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x0000021A76CF1D00>
           │       │   └ <uvicorn.server.Server object at 0x0000021A76E38B30>
           │       └ <function run at 0x0000021A7645F1A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000021A76E15000>
           │      └ <function Runner.run at 0x0000021A765E0B80>
           └ <asyncio.runners.Runner object at 0x0000021A74873B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000021A765DE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000021A74873B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000021A765DE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000021A765E0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000021A7644E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000021A7A3ED8B0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021A7A...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000021A77B209E0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000021A7A3ED8B0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021A7A...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021A7A...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000021A7A3C0CE0>
          └ <fastapi.applications.FastAPI object at 0x0000021A77B209E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000021A7A87AFC0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000021A7A404D10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000021A7A3C0CE0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000021A7A87AFC0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021A7A404CB0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000021A7A404D10>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000021A7A98B1A0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000021A7A9AD220>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021A7A404CB0>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x0000021A7A9AD220>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000021A7A98B1A0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=401, detail='Invalid token')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000021A7AB184A0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021A7A98AFC0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021A7A404CB0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x0000021A77D10C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=401, detail='Invalid token')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x0000021A7AAAECF0>
    └ <contextlib._GeneratorContextManager object at 0x0000021A7A9AD7F0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000021A7AB187C0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000021A7A9AD790>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    raise e  # Блокируем доступ, возвращая ошибку клиенту

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 34, in dispatch
    payload = self._verify_token(credentials)
              │    │             └ HTTPAuthorizationCredentials(scheme='Bearer', credentials='null')
              │    └ <function AuthMiddleware._verify_token at 0x0000021A78FD62A0>
              └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 56, in _verify_token
    raise HTTPException(status_code=401, detail="Invalid token")
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 401: Invalid token
2024-12-22 09:04:41 | ERROR | src.api.middleware.auth_middleware:dispatch:40 - Auth error: Invalid token
2024-12-22 09:04:41 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x0000021A76E25580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2312742908160, name='Task-28'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x0000021A76E25620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 356
               │     └ 3
               └ <function _main at 0x0000021A748E96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 356
           │    └ <function BaseProcess._bootstrap at 0x0000021A747D39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000021A747D2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000021A7489B0B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
    │    └ <function subprocess_started at 0x0000021A76CF28E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=744, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000021A76E38B30>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=744, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x0000021A76CF1D00>
           │       │   └ <uvicorn.server.Server object at 0x0000021A76E38B30>
           │       └ <function run at 0x0000021A7645F1A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000021A76E15000>
           │      └ <function Runner.run at 0x0000021A765E0B80>
           └ <asyncio.runners.Runner object at 0x0000021A74873B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000021A765DE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000021A74873B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000021A765DE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000021A765E0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000021A7644E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000021A7A3ED8B0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021A7A...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000021A77B209E0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000021A7A3ED8B0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021A7A...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021A7A...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000021A7A3C0CE0>
          └ <fastapi.applications.FastAPI object at 0x0000021A77B209E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000021A7AB18540>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000021A7A404D10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000021A7A3C0CE0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000021A7AB18540>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021A7A404CB0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000021A7A404D10>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000021A7AB18680>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000021A7A9ADF10>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021A7A404CB0>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x0000021A7A9ADF10>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000021A7AB18680>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=401, detail='Invalid token')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000021A7AB18CC0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021A7AB18C20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021A7A404CB0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x0000021A77D10C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=401, detail='Invalid token')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x0000021A7AAAFED0>
    └ <contextlib._GeneratorContextManager object at 0x0000021A7A9AE4E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000021A7AB18900>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000021A7A9AE480>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    raise e  # Блокируем доступ, возвращая ошибку клиенту

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 34, in dispatch
    payload = self._verify_token(credentials)
              │    │             └ HTTPAuthorizationCredentials(scheme='Bearer', credentials='null')
              │    └ <function AuthMiddleware._verify_token at 0x0000021A78FD62A0>
              └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 56, in _verify_token
    raise HTTPException(status_code=401, detail="Invalid token")
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 401: Invalid token
2024-12-22 09:04:41 | ERROR | src.api.middleware.auth_middleware:dispatch:40 - Auth error: Invalid token
2024-12-22 09:04:41 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x0000021A76E25580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2312742908160, name='Task-31'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x0000021A76E25620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 356
               │     └ 3
               └ <function _main at 0x0000021A748E96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 356
           │    └ <function BaseProcess._bootstrap at 0x0000021A747D39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000021A747D2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000021A7489B0B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
    │    └ <function subprocess_started at 0x0000021A76CF28E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=744, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000021A76E38B30>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=744, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x0000021A76CF1D00>
           │       │   └ <uvicorn.server.Server object at 0x0000021A76E38B30>
           │       └ <function run at 0x0000021A7645F1A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000021A76E15000>
           │      └ <function Runner.run at 0x0000021A765E0B80>
           └ <asyncio.runners.Runner object at 0x0000021A74873B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000021A765DE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000021A74873B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000021A765DE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000021A765E0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000021A7644E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000021A7A3ED8B0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021A7A...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000021A77B209E0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000021A7A3ED8B0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021A7A...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021A7A...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000021A7A3C0CE0>
          └ <fastapi.applications.FastAPI object at 0x0000021A77B209E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000021A7AB191C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000021A7A404D10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000021A7A3C0CE0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000021A7AB191C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021A7A404CB0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000021A7A404D10>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000021A7AB18AE0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000021A7A9AEC00>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021A7A404CB0>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x0000021A7A9AEC00>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000021A7AB18AE0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=401, detail='Invalid token')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000021A7AB19260>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021A7AB18FE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021A7A404CB0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x0000021A77D10C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=401, detail='Invalid token')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x0000021A7AB282B0>
    └ <contextlib._GeneratorContextManager object at 0x0000021A7A9AF1D0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000021A7AB18D60>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000021A7A9AF170>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    raise e  # Блокируем доступ, возвращая ошибку клиенту

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 34, in dispatch
    payload = self._verify_token(credentials)
              │    │             └ HTTPAuthorizationCredentials(scheme='Bearer', credentials='null')
              │    └ <function AuthMiddleware._verify_token at 0x0000021A78FD62A0>
              └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 56, in _verify_token
    raise HTTPException(status_code=401, detail="Invalid token")
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 401: Invalid token
2024-12-22 09:04:41 | ERROR | src.api.middleware.auth_middleware:dispatch:40 - Auth error: Invalid token
2024-12-22 09:04:41 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x0000021A76E25580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2312742908160, name='Task-34'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x0000021A76E25620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 356
               │     └ 3
               └ <function _main at 0x0000021A748E96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 356
           │    └ <function BaseProcess._bootstrap at 0x0000021A747D39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000021A747D2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000021A7489B0B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
    │    └ <function subprocess_started at 0x0000021A76CF28E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=744, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000021A76E38B30>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=744, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x0000021A76CF1D00>
           │       │   └ <uvicorn.server.Server object at 0x0000021A76E38B30>
           │       └ <function run at 0x0000021A7645F1A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000021A76E15000>
           │      └ <function Runner.run at 0x0000021A765E0B80>
           └ <asyncio.runners.Runner object at 0x0000021A74873B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000021A765DE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000021A74873B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000021A765DE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000021A765E0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000021A7644E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000021A7A3ED8B0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021A7A...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000021A77B209E0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000021A7A3ED8B0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021A7A...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021A7A...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000021A7A3C0CE0>
          └ <fastapi.applications.FastAPI object at 0x0000021A77B209E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000021A7A9A07C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000021A7A404D10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000021A7A3C0CE0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000021A7A9A07C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021A7A404CB0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000021A7A404D10>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000021A7A9A0860>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000021A7A8EAFF0>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021A7A404CB0>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x0000021A7A8EAFF0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000021A7A9A0860>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=401, detail='Invalid token')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000021A7A9A09A0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021A7A9A0B80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021A7A404CB0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x0000021A77D10C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=401, detail='Invalid token')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x0000021A7A43BE00>
    └ <contextlib._GeneratorContextManager object at 0x0000021A7A9AE450>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000021A7A87B060>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000021A7A9AE060>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    raise e  # Блокируем доступ, возвращая ошибку клиенту

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 34, in dispatch
    payload = self._verify_token(credentials)
              │    │             └ HTTPAuthorizationCredentials(scheme='Bearer', credentials='null')
              │    └ <function AuthMiddleware._verify_token at 0x0000021A78FD62A0>
              └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 56, in _verify_token
    raise HTTPException(status_code=401, detail="Invalid token")
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 401: Invalid token
2024-12-22 09:04:42 | ERROR | src.api.middleware.auth_middleware:dispatch:40 - Auth error: Invalid token
2024-12-22 09:04:42 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x0000021A76E25580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2312742908160, name='Task-37'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x0000021A76E25620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 356
               │     └ 3
               └ <function _main at 0x0000021A748E96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 356
           │    └ <function BaseProcess._bootstrap at 0x0000021A747D39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000021A747D2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000021A7489B0B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
    │    └ <function subprocess_started at 0x0000021A76CF28E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=744, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000021A76E38B30>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=744, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x0000021A76CF1D00>
           │       │   └ <uvicorn.server.Server object at 0x0000021A76E38B30>
           │       └ <function run at 0x0000021A7645F1A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000021A76E15000>
           │      └ <function Runner.run at 0x0000021A765E0B80>
           └ <asyncio.runners.Runner object at 0x0000021A74873B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000021A765DE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000021A74873B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000021A765DE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000021A765E0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000021A7644E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000021A7A3ED8B0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021A7A...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000021A77B209E0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000021A7A3ED8B0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021A7A...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021A7A...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000021A7A3C0CE0>
          └ <fastapi.applications.FastAPI object at 0x0000021A77B209E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000021A7A87B1A0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000021A7A404D10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000021A7A3C0CE0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000021A7A87B1A0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021A7A404CB0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000021A7A404D10>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000021A7A9A0A40>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000021A7A9AE720>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021A7A404CB0>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x0000021A7A9AE720>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000021A7A9A0A40>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=401, detail='Invalid token')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000021A7A98AFC0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021A7A98BCE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021A7A404CB0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x0000021A77D10C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=401, detail='Invalid token')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x0000021A7AB28110>
    └ <contextlib._GeneratorContextManager object at 0x0000021A7A9AD7F0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000021A7AB18400>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000021A7A9AD5B0>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    raise e  # Блокируем доступ, возвращая ошибку клиенту

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 34, in dispatch
    payload = self._verify_token(credentials)
              │    │             └ HTTPAuthorizationCredentials(scheme='Bearer', credentials='null')
              │    └ <function AuthMiddleware._verify_token at 0x0000021A78FD62A0>
              └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 56, in _verify_token
    raise HTTPException(status_code=401, detail="Invalid token")
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 401: Invalid token
2024-12-22 09:04:42 | ERROR | src.api.middleware.auth_middleware:dispatch:40 - Auth error: Invalid token
2024-12-22 09:04:42 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x0000021A76E25580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2312742908160, name='Task-40'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x0000021A76E25620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 356
               │     └ 3
               └ <function _main at 0x0000021A748E96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 356
           │    └ <function BaseProcess._bootstrap at 0x0000021A747D39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000021A747D2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000021A7489B0B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
    │    └ <function subprocess_started at 0x0000021A76CF28E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=1556 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=744, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000021A76E38B30>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=744, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x0000021A76CF1D00>
           │       │   └ <uvicorn.server.Server object at 0x0000021A76E38B30>
           │       └ <function run at 0x0000021A7645F1A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000021A76E15000>
           │      └ <function Runner.run at 0x0000021A765E0B80>
           └ <asyncio.runners.Runner object at 0x0000021A74873B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000021A765DE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000021A74873B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000021A765DE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000021A765E0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000021A7644E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000021A7A3ED8B0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021A7A...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000021A77B209E0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000021A7A3ED8B0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021A7A...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021A7A...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000021A7A3C0CE0>
          └ <fastapi.applications.FastAPI object at 0x0000021A77B209E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000021A7A98B1A0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000021A7A404D10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000021A7A3C0CE0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000021A7A98B1A0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021A7A404CB0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000021A7A404D10>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000021A7A9885E0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000021A7A9AF5C0>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021A7A404CB0>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x0000021A7A9AF5C0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000021A7A9885E0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=401, detail='Invalid token')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000021A7AB18C20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021A7AB18EA0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000021A7A404CB0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x0000021A77D10C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=401, detail='Invalid token')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x0000021A7AB28AD0>
    └ <contextlib._GeneratorContextManager object at 0x0000021A7A9AFB90>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000021A7AB18540>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000021A7A9AFB30>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    raise e  # Блокируем доступ, возвращая ошибку клиенту

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 34, in dispatch
    payload = self._verify_token(credentials)
              │    │             └ HTTPAuthorizationCredentials(scheme='Bearer', credentials='null')
              │    └ <function AuthMiddleware._verify_token at 0x0000021A78FD62A0>
              └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000021A7A404C80>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 56, in _verify_token
    raise HTTPException(status_code=401, detail="Invalid token")
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 401: Invalid token
2024-12-22 09:06:38 | INFO | src.app:on_shutdown:62 - Shutting down AuthService ...
2024-12-22 09:06:50 | INFO | src.integrations.logging_client:__init__:10 - LoggingClient initialized for service: AuthService
2024-12-22 09:06:50 | INFO | src.app:on_startup:54 - Starting AuthService ...
2024-12-22 09:06:50 | INFO | src.db.database:init_db:36 - Database connection is OK
2024-12-22 09:06:50 | INFO | src.app:on_startup:57 - Migrations applied successfully
2024-12-22 09:07:17 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x00000193E4325580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=1734757069056, name='Task-5'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x00000193E4325620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 188
               │     └ 3
               └ <function _main at 0x00000193E1E396C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 188
           │    └ <function BaseProcess._bootstrap at 0x00000193E1D239C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=18944 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000193E1D22F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=18944 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000193E1DEB0B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=18944 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=18944 started>
    │    └ <function subprocess_started at 0x00000193E41D28E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=18944 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=608, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000193E4338B30>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=608, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x00000193E41D1D00>
           │       │   └ <uvicorn.server.Server object at 0x00000193E4338B30>
           │       └ <function run at 0x00000193E39AF1A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000193E4315000>
           │      └ <function Runner.run at 0x00000193E3AB0B80>
           └ <asyncio.runners.Runner object at 0x00000193E1DC3B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x00000193E3AAE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x00000193E1DC3B30>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000193E3AAE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000193E3AB0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000193E399E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000193E3AEB830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000193E7...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000019...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x00000193E50909E0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000193E3AEB830>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000193E7...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000019...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000193E7...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000019...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000193E7980CE0>
          └ <fastapi.applications.FastAPI object at 0x00000193E50909E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000193E79A74C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000019...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x00000193E79C4F50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000193E7980CE0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000193E79A74C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000019...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x00000193E79C4FB0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x00000193E79C4F50>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000193E79A6A20>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x00000193E7DA3740>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000019...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x00000193E79C4FB0>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x00000193E7DA3740>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000193E79A6A20>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ AttributeError("'Settings' object has no attribute 'ACCESS_TOKEN_EXPIRE_MINUTES'")
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000193E7DF8B80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000193E7DB8FE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x00000193E79C4EF0>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x00000193E79C4FB0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x00000193E5280C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [AttributeError("'Settings' object has no attribute 'ACCESS_TOKEN_EXPIRE_MI...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x00000193E79F9FF0>
    └ <contextlib._GeneratorContextManager object at 0x00000193E7DED0A0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000193E79A7560>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x00000193E7DED040>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x00000193E79C4EF0>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x00000193E79C4EF0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 29, in dispatch
    return await call_next(request)
                 │         └ <starlette.middleware.base._CachedRequest object at 0x00000193E7DED040>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000193E79A7560>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ AttributeError("'Settings' object has no attribute 'ACCESS_TOKEN_EXPIRE_MINUTES'")
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000193E7E0B240>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000193E7E0B060>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000193E79C4F80>
          └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x00000193E79C4EF0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000193E7E0B240>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000193E7E0B060>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x00000193E7DED430>
          │                            │    └ <fastapi.routing.APIRouter object at 0x00000193E79B00E0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000193E79C4F80>
          └ <function wrap_app_handling_exceptions at 0x00000193E63B37E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000193E7E0B740>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000193E7E0B060>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <fastapi.routing.APIRouter object at 0x00000193E79B00E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000193E7E0B740>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000193E7E0B060>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x00000193E79B00E0>>
          └ <fastapi.routing.APIRouter object at 0x00000193E79B00E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000193E7E0B740>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000193E7E0B060>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │     └ <function Route.handle at 0x00000193E63D4E00>
          └ APIRoute(path='/auth/login', name='login_user', methods=['POST'])
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000193E7E0B740>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000193E7E0B060>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <function request_response.<locals>.app at 0x00000193E7977240>
          └ APIRoute(path='/auth/login', name='login_user', methods=['POST'])
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000193E7E0B740>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000193E7E0B060>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x00000193E7DED820>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x00000193E7E0B7E0>
          └ <function wrap_app_handling_exceptions at 0x00000193E63B37E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000193E7E0B920>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000193E7E0B060>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x00000193E7E0B7E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x00000193E7DED820>
                     └ <function get_request_handler.<locals>.app at 0x00000193E79772E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000193E63B3060>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'session': <sqlalchemy.orm.session.AsyncSession object at 0x00000193E7D74890>, 'user_data': UserLoginRequest(email='testuser...
                 │         └ <function login_user at 0x00000193E79754E0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=Body(Pydant...

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\routers\auth_router.py", line 28, in login_user
    tokens = await controller.login_user(user_data)
                   │          │          └ UserLoginRequest(email='testuser@example.com', password='SecurePassword123')
                   │          └ <function AuthController.login_user at 0x00000193E722F420>
                   └ <src.api.controllers.auth_controller.AuthController object at 0x00000193E7DEDF10>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\controllers\auth_controller.py", line 34, in login_user
    tokens = create_jwt_tokens(user_id=user.id)
             │                         │    └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x00000193E722C860>
             │                         └ <src.db.models.user_model.User object at 0x00000193E7E6E090>
             └ <function create_jwt_tokens at 0x00000193E722EB60>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\core\utils\security.py", line 16, in create_jwt_tokens
    access_expires = datetime.utcnow() + timedelta(minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES)
                     │        │          │                 └ Settings(SERVICE_NAME='AuthService', ENVIRONMENT='development', DEBUG=True, APP_PORT=8002, APP_HOST='0.0.0.0', API_VERSION='v...
                     │        │          └ <class 'datetime.timedelta'>
                     │        └ <method 'utcnow' of 'datetime.datetime' objects>
                     └ <class 'datetime.datetime'>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\pydantic\main.py", line 892, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
                                 │                                          └ 'ACCESS_TOKEN_EXPIRE_MINUTES'
                                 └ Settings(SERVICE_NAME='AuthService', ENVIRONMENT='development', DEBUG=True, APP_PORT=8002, APP_HOST='0.0.0.0', API_VERSION='v...

AttributeError: 'Settings' object has no attribute 'ACCESS_TOKEN_EXPIRE_MINUTES'
2024-12-22 09:11:49 | INFO | src.app:on_shutdown:62 - Shutting down AuthService ...
2024-12-22 09:12:11 | INFO | src.integrations.logging_client:__init__:10 - LoggingClient initialized for service: AuthService
2024-12-22 09:12:11 | INFO | src.app:on_startup:54 - Starting AuthService ...
2024-12-22 09:12:11 | INFO | src.db.database:init_db:36 - Database connection is OK
2024-12-22 09:12:12 | INFO | src.app:on_startup:57 - Migrations applied successfully
2024-12-22 14:53:08 | INFO | src.integrations.logging_client:__init__:10 - LoggingClient initialized for service: AuthService
2024-12-22 14:53:08 | INFO | src.app:on_startup:54 - Starting AuthService ...
2024-12-22 14:53:08 | INFO | src.db.database:init_db:36 - Database connection is OK
2024-12-22 14:53:08 | INFO | src.app:on_startup:57 - Migrations applied successfully
2024-12-22 14:53:39 | INFO | src.db.repositories.session_repository:create_session:23 - Session created for user_id=1
2024-12-22 14:55:03 | INFO | src.db.repositories.session_repository:create_session:23 - Session created for user_id=1
2024-12-22 14:57:27 | INFO | src.app:on_shutdown:62 - Shutting down AuthService ...
2024-12-22 15:05:21 | INFO | src.integrations.logging_client:__init__:10 - LoggingClient initialized for service: AuthService
2024-12-22 15:05:21 | INFO | src.app:on_startup:54 - Starting AuthService ...
2024-12-22 15:05:21 | INFO | src.db.database:init_db:36 - Database connection is OK
2024-12-22 15:05:21 | INFO | src.app:on_startup:57 - Migrations applied successfully
2024-12-22 15:05:41 | INFO | src.db.repositories.session_repository:create_session:23 - Session created for user_id=1
2024-12-22 15:06:10 | INFO | src.db.repositories.session_repository:create_session:23 - Session created for user_id=1
2024-12-22 15:15:04 | INFO | src.app:on_shutdown:62 - Shutting down AuthService ...
2024-12-22 15:15:06 | INFO | src.integrations.logging_client:__init__:10 - LoggingClient initialized for service: AuthService
2024-12-22 15:15:06 | INFO | src.app:on_startup:54 - Starting AuthService ...
2024-12-22 15:15:06 | INFO | src.db.database:init_db:36 - Database connection is OK
2024-12-22 15:15:06 | INFO | src.app:on_startup:57 - Migrations applied successfully
2024-12-22 15:15:06 | INFO | src.app:on_shutdown:62 - Shutting down AuthService ...
2024-12-22 15:15:07 | INFO | src.integrations.logging_client:__init__:10 - LoggingClient initialized for service: AuthService
2024-12-22 15:15:07 | INFO | src.app:on_startup:54 - Starting AuthService ...
2024-12-22 15:15:07 | INFO | src.db.database:init_db:36 - Database connection is OK
2024-12-22 15:15:07 | INFO | src.app:on_startup:57 - Migrations applied successfully
2024-12-22 15:15:09 | INFO | src.app:on_shutdown:62 - Shutting down AuthService ...
2024-12-22 15:28:05 | INFO | src.integrations.logging_client:__init__:10 - LoggingClient initialized for service: AuthService
2024-12-22 15:28:05 | INFO | src.app:on_startup:57 - Starting AuthService ...
2024-12-22 15:28:05 | INFO | src.db.database:init_db:36 - Database connection is OK
2024-12-22 15:28:06 | INFO | src.app:on_startup:60 - Migrations applied successfully
2024-12-22 15:30:06 | INFO | src.db.repositories.session_repository:create_session:23 - Session created for user_id=1
2024-12-22 15:30:19 | WARNING | src.api.middleware.auth_middleware:dispatch:49 - Auth error: Not authenticated
2024-12-22 15:30:19 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x0000020B98A95580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2248886055744, name='Task-27'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x0000020B98A95620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 388
               │     └ 3
               └ <function _main at 0x0000020B964E96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 388
           │    └ <function BaseProcess._bootstrap at 0x0000020B963D39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=3840 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000020B963D2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=3840 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000020B9895AFF0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=3840 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=3840 started>
    │    └ <function subprocess_started at 0x0000020B989628E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=3840 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=392, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000020B98AA8860>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=392, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x0000020B98961D00>
           │       │   └ <uvicorn.server.Server object at 0x0000020B98AA8860>
           │       └ <function run at 0x0000020B980C31A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000020B98A85000>
           │      └ <function Runner.run at 0x0000020B98250B80>
           └ <asyncio.runners.Runner object at 0x0000020B964995B0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000020B9824E7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000020B964995B0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000020B9824E700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000020B98250540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000020B980AE7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000020B98AD4320>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020B9C...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000020B9BA65580>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000020B98AD4320>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020B9C...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020B9C...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000020B9C1256A0>
          └ <fastapi.applications.FastAPI object at 0x0000020B9BA65580>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000020B9C0FB6A0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020B9C125670>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000020B9C1256A0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000020B9C0FB6A0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000020B9C1254F0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020B9C125670>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000020B9C4F7D80>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000020B9C53EF60>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000020...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000020B9C1254F0>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x0000020B9C53EF60>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000020B9C4F7D80>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=403, detail='Not authenticated')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020B9C55BCE0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020B9C55BB00>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000020B9C125640>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000020B9C1254F0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x0000020B999A0C20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=403, detail='Not authenticated')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x0000020B9C493ED0>
    └ <contextlib._GeneratorContextManager object at 0x0000020B9C53F110>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000020B9C5602C0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000020B9C53F4A0>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000020B9C125640>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000020B9C125640>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 50, in dispatch
    raise e

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    credentials: Optional[HTTPAuthorizationCredentials] = await self.auth_scheme(request)
                 │        │                                     │    │           └ <starlette.middleware.base._CachedRequest object at 0x0000020B9C53F4A0>
                 │        │                                     │    └ <fastapi.security.http.HTTPBearer object at 0x0000020B9C125700>
                 │        │                                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000020B9C125640>
                 │        └ <class 'fastapi.security.http.HTTPAuthorizationCredentials'>
                 └ typing.Optional

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\security\http.py", line 308, in __call__
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 403: Not authenticated
2024-12-22 15:31:26 | INFO | src.db.repositories.session_repository:create_session:23 - Session created for user_id=1
2024-12-22 15:32:14 | INFO | src.app:on_shutdown:68 - Shutting down AuthService ...
2024-12-22 15:39:37 | INFO | src.integrations.logging_client:__init__:10 - LoggingClient initialized for service: AuthService
2024-12-22 15:39:37 | INFO | src.app:on_startup:57 - Starting AuthService ...
2024-12-22 15:39:37 | INFO | src.db.database:init_db:39 - Database connection is OK
2024-12-22 15:39:37 | INFO | src.app:on_startup:60 - Migrations applied successfully
2024-12-22 15:39:42 | INFO | src.db.repositories.session_repository:create_session:23 - Session created for user_id=1
2024-12-22 15:39:48 | WARNING | src.api.middleware.auth_middleware:dispatch:49 - Auth error: Not authenticated
2024-12-22 15:39:48 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x0000020964BC5580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2239425052480, name='Task-16'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x0000020964BC5620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 172
               │     └ 3
               └ <function _main at 0x00000209626996C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 172
           │    └ <function BaseProcess._bootstrap at 0x00000209625839C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=19860 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000020962582F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=19860 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000020964A8AFF0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=19860 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=19860 started>
    │    └ <function subprocess_started at 0x0000020964A928E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=19860 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=452, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000020964BD8860>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=452, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x0000020964A91D00>
           │       │   └ <uvicorn.server.Server object at 0x0000020964BD8860>
           │       └ <function run at 0x00000209642D31A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000020964BB5000>
           │      └ <function Runner.run at 0x0000020964380B80>
           └ <asyncio.runners.Runner object at 0x00000209626495B0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000002096437E7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x00000209626495B0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000002096437E700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000020964380540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000209642BE7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000020964C04320>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020968...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000020964D54CB0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000020964C04320>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020968...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020968...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000020968269160>
          └ <fastapi.applications.FastAPI object at 0x0000020964D54CB0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000020964BDD1C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x00000209682692E0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000020968269160>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000020964BDD1C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000020968269190>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x00000209682692E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000020968685C60>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000002096826B260>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000020...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000020968269190>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000002096826B260>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000020968685C60>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=403, detail='Not authenticated')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002096869BF60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002096820B7E0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000020968269250>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000020968269190>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x0000020965ACCC20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=403, detail='Not authenticated')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x000002096869C2B0>
    └ <contextlib._GeneratorContextManager object at 0x0000020968682960>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000002096820B560>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x00000209686825D0>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000020968269250>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000020968269250>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 50, in dispatch
    raise e

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    credentials: Optional[HTTPAuthorizationCredentials] = await self.auth_scheme(request)
                 │        │                                     │    │           └ <starlette.middleware.base._CachedRequest object at 0x00000209686825D0>
                 │        │                                     │    └ <fastapi.security.http.HTTPBearer object at 0x0000020968269370>
                 │        │                                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000020968269250>
                 │        └ <class 'fastapi.security.http.HTTPAuthorizationCredentials'>
                 └ typing.Optional

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\security\http.py", line 308, in __call__
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 403: Not authenticated
2024-12-22 15:39:56 | INFO | src.db.repositories.session_repository:create_session:23 - Session created for user_id=1
2024-12-22 15:40:00 | WARNING | src.api.middleware.auth_middleware:dispatch:49 - Auth error: Not authenticated
2024-12-22 15:40:00 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x0000020964BC5580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2239425049600, name='Task-30'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x0000020964BC5620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 172
               │     └ 3
               └ <function _main at 0x00000209626996C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 172
           │    └ <function BaseProcess._bootstrap at 0x00000209625839C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=19860 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000020962582F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=19860 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000020964A8AFF0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=19860 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=19860 started>
    │    └ <function subprocess_started at 0x0000020964A928E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=19860 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=452, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000020964BD8860>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=452, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x0000020964A91D00>
           │       │   └ <uvicorn.server.Server object at 0x0000020964BD8860>
           │       └ <function run at 0x00000209642D31A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000020964BB5000>
           │      └ <function Runner.run at 0x0000020964380B80>
           └ <asyncio.runners.Runner object at 0x00000209626495B0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000002096437E7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x00000209626495B0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000002096437E700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000020964380540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000209642BE7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000020964C04320>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020968...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000020964D54CB0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000020964C04320>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020968...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020968...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000020968269160>
          └ <fastapi.applications.FastAPI object at 0x0000020964D54CB0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000020964BDD1C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x00000209682692E0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000020968269160>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000020964BDD1C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000020968269190>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x00000209682692E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000209687A93A0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000002096826BCB0>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000020...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000020968269190>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000002096826BCB0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000209687A93A0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=403, detail='Not authenticated')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020968637EC0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002096820B560>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000020968269250>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000020968269190>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x0000020965ACCC20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=403, detail='Not authenticated')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x00000209687893C0>
    └ <contextlib._GeneratorContextManager object at 0x00000209687CE090>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000209686A4720>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000002096865CF80>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000020968269250>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000020968269250>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 50, in dispatch
    raise e

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    credentials: Optional[HTTPAuthorizationCredentials] = await self.auth_scheme(request)
                 │        │                                     │    │           └ <starlette.middleware.base._CachedRequest object at 0x000002096865CF80>
                 │        │                                     │    └ <fastapi.security.http.HTTPBearer object at 0x0000020968269370>
                 │        │                                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000020968269250>
                 │        └ <class 'fastapi.security.http.HTTPAuthorizationCredentials'>
                 └ typing.Optional

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\security\http.py", line 308, in __call__
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 403: Not authenticated
2024-12-22 15:40:15 | INFO | src.app:on_shutdown:68 - Shutting down AuthService ...
2024-12-22 15:40:22 | INFO | src.integrations.logging_client:__init__:10 - LoggingClient initialized for service: AuthService
2024-12-22 15:40:22 | INFO | src.app:on_startup:57 - Starting AuthService ...
2024-12-22 15:40:23 | INFO | src.db.database:init_db:39 - Database connection is OK
2024-12-22 15:40:23 | INFO | src.app:on_startup:60 - Migrations applied successfully
2024-12-22 15:40:26 | INFO | src.db.repositories.session_repository:create_session:23 - Session created for user_id=1
2024-12-22 15:40:31 | WARNING | src.api.middleware.auth_middleware:dispatch:49 - Auth error: Not authenticated
2024-12-22 15:40:31 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x0000014891FB5580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=1411255317504, name='Task-15'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x0000014891FB5620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 372
               │     └ 3
               └ <function _main at 0x000001488FA496C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 372
           │    └ <function BaseProcess._bootstrap at 0x000001488F9339C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=18612 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001488F932F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=18612 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000014891E7AFF0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=18612 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=18612 started>
    │    └ <function subprocess_started at 0x0000014891E828E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=18612 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=776, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000014891FC8860>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=776, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x0000014891E81D00>
           │       │   └ <uvicorn.server.Server object at 0x0000014891FC8860>
           │       └ <function run at 0x00000148916031A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000014891FA5000>
           │      └ <function Runner.run at 0x0000014891770B80>
           └ <asyncio.runners.Runner object at 0x000001488F9F95B0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001489176E7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001488F9F95B0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001489176E700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000014891770540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000148915EE7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000014891FF4320>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000014895...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000014...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000014892CF89E0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000014891FF4320>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000014895...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000014...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000014895...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000014...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000148955E7B00>
          └ <fastapi.applications.FastAPI object at 0x0000014892CF89E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000148955DB600>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000014...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000014895635040>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000148955E7B00>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000148955DB600>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000014...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x00000148956351F0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000014895635040>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000148955DBB00>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000014895A2CDD0>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000014...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x00000148956351F0>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x0000014895A2CDD0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000148955DBB00>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=403, detail='Not authenticated')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000014895A6BCE0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000014895A6BEC0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000014895635520>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x00000148956351F0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x0000014892EDCC20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=403, detail='Not authenticated')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x0000014895A6C2B0>
    └ <contextlib._GeneratorContextManager object at 0x0000014895A52480>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000148955DB2E0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000014895A52300>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000014895635520>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000014895635520>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 50, in dispatch
    raise e

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    credentials: Optional[HTTPAuthorizationCredentials] = await self.auth_scheme(request)
                 │        │                                     │    │           └ <starlette.middleware.base._CachedRequest object at 0x0000014895A52300>
                 │        │                                     │    └ <fastapi.security.http.HTTPBearer object at 0x00000148956350A0>
                 │        │                                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000014895635520>
                 │        └ <class 'fastapi.security.http.HTTPAuthorizationCredentials'>
                 └ typing.Optional

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\security\http.py", line 308, in __call__
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 403: Not authenticated
2024-12-22 15:42:17 | INFO | src.app:on_shutdown:68 - Shutting down AuthService ...
2024-12-22 15:42:18 | INFO | src.integrations.logging_client:__init__:10 - LoggingClient initialized for service: AuthService
2024-12-22 15:42:18 | INFO | src.app:on_startup:57 - Starting AuthService ...
2024-12-22 15:42:18 | INFO | src.db.database:init_db:39 - Database connection is OK
2024-12-22 15:42:19 | INFO | src.app:on_startup:60 - Migrations applied successfully
2024-12-22 15:42:19 | INFO | src.app:on_shutdown:68 - Shutting down AuthService ...
2024-12-22 15:42:20 | INFO | src.integrations.logging_client:__init__:10 - LoggingClient initialized for service: AuthService
2024-12-22 15:42:20 | INFO | src.app:on_startup:57 - Starting AuthService ...
2024-12-22 15:42:20 | INFO | src.db.database:init_db:39 - Database connection is OK
2024-12-22 15:42:20 | INFO | src.app:on_startup:60 - Migrations applied successfully
2024-12-22 15:42:26 | INFO | src.db.repositories.session_repository:create_session:23 - Session created for user_id=1
2024-12-22 15:42:30 | WARNING | src.api.middleware.auth_middleware:dispatch:50 - Auth error: Not authenticated
2024-12-22 15:42:30 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x00000229A2F75580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2377908090048, name='Task-15'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x00000229A2F75620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 388
               │     └ 3
               └ <function _main at 0x00000229A0A296C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 388
           │    └ <function BaseProcess._bootstrap at 0x00000229A09139C0>
           └ <SpawnProcess name='SpawnProcess-3' parent=18612 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000229A0912F20>
    └ <SpawnProcess name='SpawnProcess-3' parent=18612 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000229A2E1AFF0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=18612 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=18612 started>
    │    └ <function subprocess_started at 0x00000229A2E228E0>
    └ <SpawnProcess name='SpawnProcess-3' parent=18612 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=616, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000229A2F88860>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=616, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x00000229A2E21D00>
           │       │   └ <uvicorn.server.Server object at 0x00000229A2F88860>
           │       └ <function run at 0x00000229A25F31A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000229A2F65000>
           │      └ <function Runner.run at 0x00000229A26C0B80>
           └ <asyncio.runners.Runner object at 0x00000229A09D95B0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x00000229A26BE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x00000229A09D95B0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000229A26BE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000229A26C0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000229A25DE7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000229A2FB4320>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000229A6...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x00000229A3CE89E0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000229A2FB4320>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000229A6...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000229A6...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000229A6625040>
          └ <fastapi.applications.FastAPI object at 0x00000229A3CE89E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000229A69F7E20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x00000229A6624FB0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000229A6625040>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000229A69F7E20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x00000229A66254C0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x00000229A6624FB0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000229A65CBB00>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x00000229A6A1DF10>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000022...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x00000229A66254C0>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x00000229A6A1DF10>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000229A65CBB00>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=403, detail='Not authenticated')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000229A6A5BCE0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000229A6A51BC0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x00000229A66255B0>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x00000229A66254C0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x00000229A3ECCC20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=403, detail='Not authenticated')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x00000229A6A5C2B0>
    └ <contextlib._GeneratorContextManager object at 0x00000229A6A3E780>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000229A6A64040>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x00000229A6A3E6F0>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x00000229A66255B0>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x00000229A66255B0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 51, in dispatch
    raise e

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    credentials: Optional[HTTPAuthorizationCredentials] = await self.auth_scheme(request)
                 │        │                                     │    │           └ <starlette.middleware.base._CachedRequest object at 0x00000229A6A3E6F0>
                 │        │                                     │    └ <fastapi.security.http.HTTPBearer object at 0x00000229A6625130>
                 │        │                                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x00000229A66255B0>
                 │        └ <class 'fastapi.security.http.HTTPAuthorizationCredentials'>
                 └ typing.Optional

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\security\http.py", line 308, in __call__
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 403: Not authenticated
2024-12-22 15:44:35 | INFO | src.app:on_shutdown:68 - Shutting down AuthService ...
2024-12-22 15:44:36 | INFO | src.integrations.logging_client:__init__:10 - LoggingClient initialized for service: AuthService
2024-12-22 15:44:36 | INFO | src.app:on_startup:57 - Starting AuthService ...
2024-12-22 15:44:37 | INFO | src.db.database:init_db:39 - Database connection is OK
2024-12-22 15:44:37 | INFO | src.app:on_startup:60 - Migrations applied successfully
2024-12-22 15:44:47 | INFO | src.db.repositories.session_repository:create_session:23 - Session created for user_id=1
2024-12-22 15:44:50 | WARNING | src.api.middleware.auth_middleware:dispatch:50 - Auth error: Not authenticated
2024-12-22 15:44:50 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x0000020EB7105580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2262280582336, name='Task-15'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x0000020EB7105620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 340
               │     └ 3
               └ <function _main at 0x0000020EB4BD96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 340
           │    └ <function BaseProcess._bootstrap at 0x0000020EB4AC39C0>
           └ <SpawnProcess name='SpawnProcess-4' parent=18612 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000020EB4AC2F20>
    └ <SpawnProcess name='SpawnProcess-4' parent=18612 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000020EB6FCAFF0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-4' parent=18612 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-4' parent=18612 started>
    │    └ <function subprocess_started at 0x0000020EB6FD28E0>
    └ <SpawnProcess name='SpawnProcess-4' parent=18612 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=468, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000020EB7118860>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=468, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x0000020EB6FD1D00>
           │       │   └ <uvicorn.server.Server object at 0x0000020EB7118860>
           │       └ <function run at 0x0000020EB68131A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000020EB70F5000>
           │      └ <function Runner.run at 0x0000020EB68C0B80>
           └ <asyncio.runners.Runner object at 0x0000020EB4B895B0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000020EB68BE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000020EB4B895B0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000020EB68BE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000020EB68C0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000020EB67FE7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000020EBA6DBAA0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020EBA...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000020EB7294CB0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000020EBA6DBAA0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020EBA...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020EBA...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000020EBA724FB0>
          └ <fastapi.applications.FastAPI object at 0x0000020EB7294CB0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000020EBA6CB560>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020EBA7251F0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000020EBA724FB0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000020EBA6CB560>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000020EBA6D9370>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020EBA7251F0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000020EBA6CB7E0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000020EBAB2DF40>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000020...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000020EBA6D9370>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x0000020EBAB2DF40>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000020EBA6CB7E0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=403, detail='Not authenticated')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020EBAB6BF60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020EBAB61C60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000020EBA724F80>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000020EBA6D9370>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x0000020EB7FECC20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=403, detail='Not authenticated')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x0000020EBAB702B0>
    └ <contextlib._GeneratorContextManager object at 0x0000020EBAB4E7E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000020EBAB780E0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000020EBAB4F2F0>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000020EBA724F80>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000020EBA724F80>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 51, in dispatch
    raise e

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    credentials: Optional[HTTPAuthorizationCredentials] = await self.auth_scheme(request)
                 │        │                                     │    │           └ <starlette.middleware.base._CachedRequest object at 0x0000020EBAB4F2F0>
                 │        │                                     │    └ <fastapi.security.http.HTTPBearer object at 0x0000020EBA724E30>
                 │        │                                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000020EBA724F80>
                 │        └ <class 'fastapi.security.http.HTTPAuthorizationCredentials'>
                 └ typing.Optional

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\security\http.py", line 308, in __call__
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 403: Not authenticated
2024-12-22 15:46:00 | INFO | src.app:on_shutdown:68 - Shutting down AuthService ...
2024-12-22 15:49:26 | INFO | src.integrations.logging_client:__init__:10 - LoggingClient initialized for service: AuthService
2024-12-22 15:49:26 | INFO | src.app:on_startup:57 - Starting AuthService ...
2024-12-22 15:49:26 | INFO | src.db.database:init_db:39 - Database connection is OK
2024-12-22 15:49:26 | INFO | src.app:on_startup:60 - Migrations applied successfully
2024-12-22 15:49:33 | INFO | src.db.repositories.session_repository:create_session:29 - Session created for user_id=1 with refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxIiwiZXhwIjoxNzM1NDU4NTczfQ.KxIgCk1q09fv6OlteAJPRW1ZalSeJm5o1cYMBwjzSKw
2024-12-22 15:49:37 | WARNING | src.api.middleware.auth_middleware:dispatch:50 - Auth error: Not authenticated
2024-12-22 15:49:37 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x0000027F64F35580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2746234484864, name='Task-15'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x0000027F64F35620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 372
               │     └ 3
               └ <function _main at 0x0000027F62A296C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 372
           │    └ <function BaseProcess._bootstrap at 0x0000027F629139C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=15784 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000027F62912F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=15784 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000027F64DFAFF0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=15784 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=15784 started>
    │    └ <function subprocess_started at 0x0000027F64E028E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=15784 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=780, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000027F64F48860>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=780, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x0000027F64E01D00>
           │       │   └ <uvicorn.server.Server object at 0x0000027F64F48860>
           │       └ <function run at 0x0000027F645A31A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000027F64F25000>
           │      └ <function Runner.run at 0x0000027F646F0B80>
           └ <asyncio.runners.Runner object at 0x0000027F629D95B0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000027F646EE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000027F629D95B0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000027F646EE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000027F646F0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000027F6458E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000027F64F74320>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027F68...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000027F67E647A0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000027F64F74320>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027F68...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027F68...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000027F685E5310>
          └ <fastapi.applications.FastAPI object at 0x0000027F67E647A0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000027F6858F2E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000027F685E5790>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000027F685E5310>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000027F6858F2E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000027F685983B0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000027F685E5790>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000027F6858F600>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000027F689D94F0>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000027...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000027F685983B0>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_Service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x0000027F689D94F0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000027F6858F600>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=403, detail='Not authenticated')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000027F68B294E0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000027F68A1FEC0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000027F685E56D0>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000027F685983B0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x0000027F65E0CC20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=403, detail='Not authenticated')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x0000027F68A18790>
    └ <contextlib._GeneratorContextManager object at 0x0000027F689FAA80>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000027F68A28860>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000027F689FA9F0>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000027F685E56D0>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000027F685E56D0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_Service\src\api\middleware\auth_middleware.py", line 51, in dispatch
    raise e

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_Service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    credentials: Optional[HTTPAuthorizationCredentials] = await self.auth_scheme(request)
                 │        │                                     │    │           └ <starlette.middleware.base._CachedRequest object at 0x0000027F689FA9F0>
                 │        │                                     │    └ <fastapi.security.http.HTTPBearer object at 0x0000027F685E56A0>
                 │        │                                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000027F685E56D0>
                 │        └ <class 'fastapi.security.http.HTTPAuthorizationCredentials'>
                 └ typing.Optional

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\security\http.py", line 308, in __call__
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 403: Not authenticated
2024-12-22 15:49:58 | INFO | src.db.repositories.session_repository:create_session:29 - Session created for user_id=1 with refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxIiwiZXhwIjoxNzM1NDU4NTk4fQ.fhfneWnJxDxJkxo_H4Nd0qcBjqAm32JAFPCt50ZcklY
2024-12-22 15:50:01 | WARNING | src.api.middleware.auth_middleware:dispatch:50 - Auth error: Not authenticated
2024-12-22 15:50:01 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x0000027F64F35580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2746234484864, name='Task-29'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x0000027F64F35620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 372
               │     └ 3
               └ <function _main at 0x0000027F62A296C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 372
           │    └ <function BaseProcess._bootstrap at 0x0000027F629139C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=15784 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000027F62912F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=15784 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000027F64DFAFF0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=15784 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=15784 started>
    │    └ <function subprocess_started at 0x0000027F64E028E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=15784 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=780, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000027F64F48860>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=780, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x0000027F64E01D00>
           │       │   └ <uvicorn.server.Server object at 0x0000027F64F48860>
           │       └ <function run at 0x0000027F645A31A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000027F64F25000>
           │      └ <function Runner.run at 0x0000027F646F0B80>
           └ <asyncio.runners.Runner object at 0x0000027F629D95B0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000027F646EE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000027F629D95B0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000027F646EE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000027F646F0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000027F6458E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000027F64F74320>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027F68...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000027F67E647A0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000027F64F74320>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027F68...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027F68...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000027F685E5310>
          └ <fastapi.applications.FastAPI object at 0x0000027F67E647A0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000027F68A11DA0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000027F685E5790>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000027F685E5310>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000027F68A11DA0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000027F685983B0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000027F685E5790>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000027F68A287C0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000027F68B4AE40>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000027...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000027F685983B0>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_Service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x0000027F68B4AE40>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000027F68A287C0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=403, detail='Not authenticated')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000027F68A28EA0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000027F68A28220>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000027F685E56D0>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000027F685983B0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x0000027F65E0CC20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=403, detail='Not authenticated')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x0000027F6855A9B0>
    └ <contextlib._GeneratorContextManager object at 0x0000027F68B4B020>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000027F68A1FEC0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000027F68B4AF90>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000027F685E56D0>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000027F685E56D0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_Service\src\api\middleware\auth_middleware.py", line 51, in dispatch
    raise e

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_Service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    credentials: Optional[HTTPAuthorizationCredentials] = await self.auth_scheme(request)
                 │        │                                     │    │           └ <starlette.middleware.base._CachedRequest object at 0x0000027F68B4AF90>
                 │        │                                     │    └ <fastapi.security.http.HTTPBearer object at 0x0000027F685E56A0>
                 │        │                                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000027F685E56D0>
                 │        └ <class 'fastapi.security.http.HTTPAuthorizationCredentials'>
                 └ typing.Optional

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\security\http.py", line 308, in __call__
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 403: Not authenticated
2024-12-22 15:51:05 | INFO | src.app:on_shutdown:68 - Shutting down AuthService ...
2024-12-22 15:57:51 | INFO | src.integrations.logging_client:__init__:10 - LoggingClient initialized for service: AuthService
2024-12-22 15:57:51 | INFO | src.app:on_startup:57 - Starting AuthService ...
2024-12-22 15:57:51 | INFO | src.db.database:init_db:39 - Database connection is OK
2024-12-22 15:57:51 | INFO | src.app:on_startup:60 - Migrations applied successfully
2024-12-22 15:57:54 | INFO | src.db.repositories.session_repository:create_session:29 - Session created for user_id=1 with refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxIiwiZXhwIjoxNzM1NDU5MDc0fQ.lP0iUBtWKl8sSrAjtXjxb_LpAREVosYzvTVsLdSHuCo
2024-12-22 15:57:56 | WARNING | src.api.middleware.auth_middleware:dispatch:50 - Auth error: Not authenticated
2024-12-22 15:57:56 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000002044B035580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=2217518086272, name='Task-15'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000002044B035620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 368
               │     └ 3
               └ <function _main at 0x0000020448AD96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 368
           │    └ <function BaseProcess._bootstrap at 0x00000204489C39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=15200 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000204489C2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=15200 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002044AEFAFF0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=15200 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=15200 started>
    │    └ <function subprocess_started at 0x000002044AF028E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=15200 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=740, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000002044B048860>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=740, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000002044AF01D00>
           │       │   └ <uvicorn.server.Server object at 0x000002044B048860>
           │       └ <function run at 0x000002044A6B31A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000002044B025000>
           │      └ <function Runner.run at 0x000002044A7F0B80>
           └ <asyncio.runners.Runner object at 0x0000020448A895B0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000002044A7EE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000020448A895B0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000002044A7EE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002044A7F0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002044A69E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002044B074320>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002044E...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000002044D0A8D10>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002044B074320>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002044E...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002044E...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002044E657A40>
          └ <fastapi.applications.FastAPI object at 0x000002044D0A8D10>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000002044E64B2E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000002044E6A4F80>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002044E657A40>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000002044E64B2E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000002044DF79370>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000002044E6A4F80>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000002044E64BB00>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000002044EACDE20>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000020...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000002044DF79370>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_Service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000002044EACDE20>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000002044E64BB00>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=403, detail='Not authenticated')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002044EB189A0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002044EAABE20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000002044E6A4EC0>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x000002044DF79370>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x000002044BF8CC20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=403, detail='Not authenticated')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x000002044EAFCA00>
    └ <contextlib._GeneratorContextManager object at 0x000002044EAF2690>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000002044EB19260>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000002044EAF2900>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000002044E6A4EC0>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000002044E6A4EC0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_Service\src\api\middleware\auth_middleware.py", line 51, in dispatch
    raise e

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_Service\src\api\middleware\auth_middleware.py", line 41, in dispatch
    credentials: Optional[HTTPAuthorizationCredentials] = await self.auth_scheme(request)
                 │        │                                     │    │           └ <starlette.middleware.base._CachedRequest object at 0x000002044EAF2900>
                 │        │                                     │    └ <fastapi.security.http.HTTPBearer object at 0x000002044E6A4E30>
                 │        │                                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x000002044E6A4EC0>
                 │        └ <class 'fastapi.security.http.HTTPAuthorizationCredentials'>
                 └ typing.Optional

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\security\http.py", line 308, in __call__
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 403: Not authenticated
2024-12-22 16:00:44 | INFO | src.app:on_shutdown:68 - Shutting down AuthService ...
2024-12-22 16:00:46 | INFO | src.integrations.logging_client:__init__:10 - LoggingClient initialized for service: AuthService
2024-12-22 16:00:46 | INFO | src.app:on_startup:57 - Starting AuthService ...
2024-12-22 16:00:46 | INFO | src.db.database:init_db:39 - Database connection is OK
2024-12-22 16:00:46 | INFO | src.app:on_startup:60 - Migrations applied successfully
2024-12-22 16:00:55 | INFO | src.db.repositories.session_repository:create_session:29 - Session created for user_id=1 with refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxIiwiZXhwIjoxNzM1NDU5MjU1fQ.LtzYKlCwCHWjnfVa9zVZFQ_MQFIqvQK1aZV2ASmFyfs
2024-12-22 16:00:59 | WARNING | src.api.middleware.auth_middleware:dispatch:52 - Authentication failed: Not authenticated
2024-12-22 16:00:59 | ERROR | src.api.middleware.error_handler:dispatch:17 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x0000011470D55580>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           └ MemoryObjectItemReceiver(task_info=AsyncIOTaskInfo(id=1187361044800, name='Task-15'), item=None)

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x0000011470D55620>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 356
               │     └ 3
               └ <function _main at 0x000001146E8496C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 356
           │    └ <function BaseProcess._bootstrap at 0x000001146E7339C0>
           └ <SpawnProcess name='SpawnProcess-2' parent=15200 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001146E732F20>
    └ <SpawnProcess name='SpawnProcess-2' parent=15200 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000011470BFAFF0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-2' parent=15200 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-2' parent=15200 started>
    │    └ <function subprocess_started at 0x0000011470C028E0>
    └ <SpawnProcess name='SpawnProcess-2' parent=15200 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=504, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000011470D68860>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=504, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x0000011470C01D00>
           │       │   └ <uvicorn.server.Server object at 0x0000011470D68860>
           │       └ <function run at 0x00000114703D31A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000011470D45000>
           │      └ <function Runner.run at 0x00000114704C0B80>
           └ <asyncio.runners.Runner object at 0x000001146E7F95B0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x00000114704BE7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001146E7F95B0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000114704BE700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000114704C0540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000114703BE7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000011474407680>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000011474...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000011...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000011472DC8D10>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000011474407680>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000011474...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000011...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000011474...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000011...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000114744550D0>
          └ <fastapi.applications.FastAPI object at 0x0000011472DC8D10>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000011474424C20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000011...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000011474455190>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000114744550D0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000011474424C20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000011...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x00000114744554C0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000011474455190>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000011474427740>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001147484D070>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000011...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x00000114744554C0>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_Service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001147484D070>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000011474427740>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ HTTPException(status_code=403, detail='Not authenticated')
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000011474898AE0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001147482BF60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x00000114744555B0>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x00000114744554C0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x0000011471CACC20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [HTTPException(status_code=403, detail='Not authenticated')])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x0000011474878A00>
    └ <contextlib._GeneratorContextManager object at 0x00000114748768D0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000114748993A0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000011474876840>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x00000114744555B0>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x00000114744555B0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_Service\src\api\middleware\auth_middleware.py", line 53, in dispatch
    raise e

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_Service\src\api\middleware\auth_middleware.py", line 42, in dispatch
    credentials: Optional[HTTPAuthorizationCredentials] = await self.auth_scheme(request)
                 │        │                                     │    │           └ <starlette.middleware.base._CachedRequest object at 0x0000011474876840>
                 │        │                                     │    └ <fastapi.security.http.HTTPBearer object at 0x0000011474454FE0>
                 │        │                                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x00000114744555B0>
                 │        └ <class 'fastapi.security.http.HTTPAuthorizationCredentials'>
                 └ typing.Optional

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\security\http.py", line 308, in __call__
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException: 403: Not authenticated
2024-12-22 16:01:21 | INFO | src.app:on_shutdown:68 - Shutting down AuthService ...
2024-12-22 16:06:01 | INFO | src.integrations.logging_client:__init__:10 - LoggingClient initialized for service: AuthService
2024-12-22 16:06:01 | INFO | src.app:on_startup:57 - Starting AuthService ...
2024-12-22 16:06:01 | INFO | src.db.database:init_db:39 - Database connection is OK
2024-12-22 16:06:02 | INFO | src.app:on_startup:60 - Migrations applied successfully
2024-12-22 16:06:09 | INFO | src.db.repositories.session_repository:create_session:29 - Session created for user_id=1 with refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxIiwiZXhwIjoxNzM1NDU5NTY5fQ.ec6U6lNCHSGovtPDoGO39jsOnUDkAF6ptc05vncScjc
2024-12-22 16:06:16 | WARNING | src.api.middleware.auth_middleware:dispatch:52 - Authentication failed: Not authenticated
2024-12-22 16:09:56 | INFO | src.app:on_shutdown:68 - Shutting down AuthService ...
2024-12-22 16:09:57 | INFO | src.integrations.logging_client:__init__:10 - LoggingClient initialized for service: AuthService
2024-12-22 16:09:57 | INFO | src.app:on_startup:57 - Starting AuthService ...
2024-12-22 16:09:57 | INFO | src.db.database:init_db:39 - Database connection is OK
2024-12-22 16:09:58 | INFO | src.app:on_startup:60 - Migrations applied successfully
2024-12-22 16:09:58 | INFO | src.app:on_shutdown:68 - Shutting down AuthService ...
2024-12-22 16:09:59 | INFO | src.integrations.logging_client:__init__:10 - LoggingClient initialized for service: AuthService
2024-12-22 16:09:59 | INFO | src.app:on_startup:57 - Starting AuthService ...
2024-12-22 16:09:59 | INFO | src.db.database:init_db:39 - Database connection is OK
2024-12-22 16:09:59 | INFO | src.app:on_startup:60 - Migrations applied successfully
2024-12-22 16:10:09 | INFO | src.db.repositories.session_repository:create_session:29 - Session created for user_id=1 with refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxIiwiZXhwIjoxNzM1NDU5ODA5fQ.2urQQePQUJh6qHwYv84KP4TVNtMFsBGuvCNlkeMOaek
2024-12-22 16:10:12 | WARNING | src.api.middleware.auth_middleware:dispatch:52 - Authentication failed: Not authenticated
2024-12-22 16:12:06 | INFO | src.app:on_shutdown:68 - Shutting down AuthService ...
2024-12-22 16:13:18 | INFO | src.integrations.logging_client:__init__:10 - LoggingClient initialized for service: AuthService
2024-12-22 16:13:18 | INFO | src.app:on_startup:57 - Starting AuthService ...
2024-12-22 16:13:18 | INFO | src.db.database:init_db:39 - Database connection is OK
2024-12-22 16:13:19 | INFO | src.app:on_startup:60 - Migrations applied successfully
2024-12-22 16:14:28 | INFO | src.db.repositories.session_repository:create_session:29 - Session created for user_id=1 with refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxIiwiZXhwIjoxNzM1NDYwMDY4fQ.dibRnBsZE7P-7uQFYx4puqZ2KYPWgPDweSe_R3zDuA8
2024-12-22 16:14:36 | WARNING | src.api.middleware.auth_middleware:dispatch:52 - Authentication failed: Not authenticated
2024-12-22 16:20:39 | INFO | src.db.repositories.user_repository:create_user:38 - User created with email: test@example.com
2024-12-22 16:21:11 | INFO | src.db.repositories.session_repository:create_session:29 - Session created for user_id=2 with refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwiZXhwIjoxNzM1NDYwNDcxfQ.2svgc3UkTvXfyQYqqblCu81oS0nYwp58wJtXPG0LPMU
2024-12-22 16:21:25 | ERROR | src.api.middleware.error_handler:dispatch:20 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 510, in _prepare_and_execute
    prepared_stmt, attributes = await adapt_connection._prepare(
                                      │                └ <function AsyncAdapt_asyncpg_connection._prepare at 0x00000200CC540900>
                                      └ <AdaptedConnection <asyncpg.connection.Connection object at 0x00000200CC78E8A0>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 756, in _prepare
    prepared_stmt = await self._connection.prepare(
                          │    └ <member '_connection' of 'AdaptedConnection' objects>
                          └ <AdaptedConnection <asyncpg.connection.Connection object at 0x00000200CC78E8A0>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\asyncpg\connection.py", line 635, in prepare
    return await self._prepare(
                 │    └ <function Connection._prepare at 0x00000200CC713EC0>
                 └ <asyncpg.connection.Connection object at 0x00000200CC78E8A0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\asyncpg\connection.py", line 653, in _prepare
    stmt = await self._get_statement(
                 │    └ <function Connection._get_statement at 0x00000200CC713BA0>
                 └ <asyncpg.connection.Connection object at 0x00000200CC78E8A0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\asyncpg\connection.py", line 432, in _get_statement
    statement = await self._protocol.prepare(
                      │    └ <member '_protocol' of 'Connection' objects>
                      └ <asyncpg.connection.Connection object at 0x00000200CC78E8A0>
  File "asyncpg\\protocol\\protocol.pyx", line 165, in prepare
    return await waiter

asyncpg.exceptions.UndefinedFunctionError: оператор не существует: integer = character varying
HINT:  Оператор с данными именем и типами аргументов не найден. Возможно, вам следует добавить явные приведения типов.


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x00000200CBBD18A0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x00000200CC065700>
    └ <sqlalchemy.engine.base.Connection object at 0x00000200CCD292B0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('2',)
    │      │       └ 'SELECT users.id, users.email, users.hashed_password, users.is_active, users.created_at, users.updated_at \nFROM users \nWHER...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x00000200CC53BC40>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000200CCBCDAE0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000200CCBCDAE0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           │       │             └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x00000200CC769540>
           │       └ <attribute 'parent' of 'greenlet.greenlet' objects>
           └ <_AsyncIoGreenlet object at 0x00000200CCD33D40 (otid=0x00000200CB3BE0A0) dead>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
                  └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x00000200CC769540>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x00000200CC53BA60>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000200CCBCDAE0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ UndefinedFunctionError('оператор не существует: integer = character varying')
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000200CCBCDAE0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
          │                     └ UndefinedFunctionError('оператор не существует: integer = character varying')
          └ ProgrammingError("<class 'asyncpg.exceptions.UndefinedFunctionError'>: оператор не существует: integer = character varying\nH...

sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.UndefinedFunctionError'>: оператор не существует: integer = character varying
HINT:  Оператор с данными именем и типами аргументов не найден. Возможно, вам следует добавить явные приведения типов.


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 344
               │     └ 3
               └ <function _main at 0x00000200C6BE96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 344
           │    └ <function BaseProcess._bootstrap at 0x00000200C6AD39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=16364 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000200C6AD2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=16364 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000200C902AFF0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=16364 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=16364 started>
    │    └ <function subprocess_started at 0x00000200C90328E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=16364 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=768, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000200C9178860>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=768, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x00000200C9031D00>
           │       │   └ <uvicorn.server.Server object at 0x00000200C9178860>
           │       └ <function run at 0x00000200C88731A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000200C9155000>
           │      └ <function Runner.run at 0x00000200C8920B80>
           └ <asyncio.runners.Runner object at 0x00000200C6B995B0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x00000200C891E7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x00000200C6B995B0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000200C891E700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000200C8920540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000200C885E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000200C91A4320>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000200CC...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x00000200CB193440>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000200C91A4320>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000200CC...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000200CC...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000200CC7A4EC0>
          └ <fastapi.applications.FastAPI object at 0x00000200CB193440>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000200CCD02DE0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x00000200CC7A4E00>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000200CC7A4EC0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000200CCD02DE0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x00000200CC757560>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x00000200CC7A4E00>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000200CCD02CA0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x00000200CCD0B9B0>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000020...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x00000200CC757560>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x00000200CCD0B9B0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000200CCD02CA0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ ProgrammingError("(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000200CC74B7E0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000200CC74BBA0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x00000200CC7A51C0>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x00000200CC757560>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x00000200CA04CC20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ProgrammingError("(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x00000200CCBB4EE0>
    └ <contextlib._GeneratorContextManager object at 0x00000200CCD09C70>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000200CCBED760>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x00000200CCD0AC60>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x00000200CC7A51C0>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x00000200CC7A51C0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 58, in dispatch
    return await call_next(request)
                 │         └ <starlette.middleware.base._CachedRequest object at 0x00000200CCD0AC60>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000200CCBED760>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ ProgrammingError("(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000200CCBED4E0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000200CCBED080>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000200CC7A4F50>
          └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x00000200CC7A51C0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000200CCBED4E0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000200CCBED080>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x00000200CCD0B020>
          │                            │    └ <fastapi.routing.APIRouter object at 0x00000200CC778FB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000200CC7A4F50>
          └ <function wrap_app_handling_exceptions at 0x00000200CB1837E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000200CCD1E0C0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000200CCBED080>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <fastapi.routing.APIRouter object at 0x00000200CC778FB0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000200CCD1E0C0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000200CCBED080>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x00000200CC778FB0>>
          └ <fastapi.routing.APIRouter object at 0x00000200CC778FB0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000200CCD1E0C0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000200CCBED080>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │     └ <function Route.handle at 0x00000200CB1A4E00>
          └ APIRoute(path='/auth/me', name='get_current_user', methods=['GET'])
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000200CCD1E0C0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000200CCBED080>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <function request_response.<locals>.app at 0x00000200CC749C60>
          └ APIRoute(path='/auth/me', name='get_current_user', methods=['GET'])
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000200CCD1E0C0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000200CCBED080>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x00000200CCD28CB0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x00000200CCD1EC00>
          └ <function wrap_app_handling_exceptions at 0x00000200CB1837E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000200CCD1E2A0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000200CCBED080>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x00000200CCD1EC00>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x00000200CCD28CB0>
                     └ <function get_request_handler.<locals>.app at 0x00000200CC74A520>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000200CB183060>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'session': <sqlalchemy.orm.session.AsyncSession object at 0x00000200CCD28EF0>, 'request': <starlette.requests.Request object...
                 │         └ <function get_current_user at 0x00000200CC74A0C0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[], dependencies=[Dependant(path_p...

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\routers\auth_router.py", line 72, in get_current_user
    user = await user_repo.get_by_id(user_id)
                 │         │         └ '2'
                 │         └ <function UserRepository.get_by_id at 0x00000200CBFBA700>
                 └ <src.db.repositories.user_repository.UserRepository object at 0x00000200CCD29160>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\db\repositories\user_repository.py", line 26, in get_by_id
    result = await self.session.execute(q)
                   │    │       │       └ <sqlalchemy.sql.selectable.Select object at 0x00000200CCD28DA0>
                   │    │       └ <function AsyncSession.execute at 0x00000200CBFA3880>
                   │    └ <sqlalchemy.orm.session.AsyncSession object at 0x00000200CCD28EF0>
                   └ <src.db.repositories.user_repository.UserRepository object at 0x00000200CCD29160>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 461, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x00000200CB571260>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x00000200CCD33D40 (otid=0x00000200CB3BE0A0) dead>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2362, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x00000200CBECBCE0>
           └ <sqlalchemy.orm.session.Session object at 0x00000200CCD29190>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x00000200CBD60FE0>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x00000200CBB1E480>
             └ <sqlalchemy.engine.base.Connection object at 0x00000200CCD292B0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x00000200CCD28DA0>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x00000200CBB1E7A0>
           └ <sqlalchemy.engine.base.Connection object at 0x00000200CCD292B0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x00000200CBB1E980>
          └ <sqlalchemy.engine.base.Connection object at 0x00000200CCD292B0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x00000200CBB1EA20>
           └ <sqlalchemy.engine.base.Connection object at 0x00000200CCD292B0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x00000200CBB1ECA0>
    └ <sqlalchemy.engine.base.Connection object at 0x00000200CCD292B0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ ProgrammingError("<class 'asyncpg.exceptions.UndefinedFunctionError'>: оператор не существует: integer = character varying\nH...
          │                    │              └ (<class 'sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError'>, ProgrammingError("<class 'asyncp...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError("(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x00000200CBBD18A0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x00000200CC065700>
    └ <sqlalchemy.engine.base.Connection object at 0x00000200CCD292B0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('2',)
    │      │       └ 'SELECT users.id, users.email, users.hashed_password, users.is_active, users.created_at, users.updated_at \nFROM users \nWHER...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x00000200CC53BC40>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000200CCBCDAE0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000200CCBCDAE0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           │       │             └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x00000200CC769540>
           │       └ <attribute 'parent' of 'greenlet.greenlet' objects>
           └ <_AsyncIoGreenlet object at 0x00000200CCD33D40 (otid=0x00000200CB3BE0A0) dead>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
                  └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x00000200CC769540>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x00000200CC53BA60>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000200CCBCDAE0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ UndefinedFunctionError('оператор не существует: integer = character varying')
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000200CCBCDAE0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
          │                     └ UndefinedFunctionError('оператор не существует: integer = character varying')
          └ ProgrammingError("<class 'asyncpg.exceptions.UndefinedFunctionError'>: оператор не существует: integer = character varying\nH...

sqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: оператор не существует: integer = character varying
HINT:  Оператор с данными именем и типами аргументов не найден. Возможно, вам следует добавить явные приведения типов.
[SQL: SELECT users.id, users.email, users.hashed_password, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::VARCHAR]
[parameters: ('2',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2024-12-22 16:21:35 | INFO | src.db.repositories.session_repository:delete_session_by_token:49 - Session with refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwiZXhwIjoxNzM1NDYwNDcxfQ.2svgc3UkTvXfyQYqqblCu81oS0nYwp58wJtXPG0LPMU deleted successfully
2024-12-22 16:21:49 | INFO | src.db.repositories.session_repository:create_session:29 - Session created for user_id=2 with refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwiZXhwIjoxNzM1NDYwNTA5fQ.fNR3Wkv3CzEFKQ85iQEk08jOoaq9cxtBZGJNUI4MFLE
2024-12-22 16:21:53 | ERROR | src.api.middleware.error_handler:dispatch:20 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 510, in _prepare_and_execute
    prepared_stmt, attributes = await adapt_connection._prepare(
                                      │                └ <function AsyncAdapt_asyncpg_connection._prepare at 0x00000200CC540900>
                                      └ <AdaptedConnection <asyncpg.connection.Connection object at 0x00000200CC78E8A0>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 756, in _prepare
    prepared_stmt = await self._connection.prepare(
                          │    └ <member '_connection' of 'AdaptedConnection' objects>
                          └ <AdaptedConnection <asyncpg.connection.Connection object at 0x00000200CC78E8A0>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\asyncpg\connection.py", line 635, in prepare
    return await self._prepare(
                 │    └ <function Connection._prepare at 0x00000200CC713EC0>
                 └ <asyncpg.connection.Connection object at 0x00000200CC78E8A0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\asyncpg\connection.py", line 653, in _prepare
    stmt = await self._get_statement(
                 │    └ <function Connection._get_statement at 0x00000200CC713BA0>
                 └ <asyncpg.connection.Connection object at 0x00000200CC78E8A0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\asyncpg\connection.py", line 432, in _get_statement
    statement = await self._protocol.prepare(
                      │    └ <member '_protocol' of 'Connection' objects>
                      └ <asyncpg.connection.Connection object at 0x00000200CC78E8A0>
  File "asyncpg\\protocol\\protocol.pyx", line 165, in prepare
    return await waiter

asyncpg.exceptions.UndefinedFunctionError: оператор не существует: integer = character varying
HINT:  Оператор с данными именем и типами аргументов не найден. Возможно, вам следует добавить явные приведения типов.


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x00000200CBBD18A0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x00000200CC065700>
    └ <sqlalchemy.engine.base.Connection object at 0x00000200CDFD9EB0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('2',)
    │      │       └ 'SELECT users.id, users.email, users.hashed_password, users.is_active, users.created_at, users.updated_at \nFROM users \nWHER...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x00000200CC53BC40>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000200CCBCE620>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000200CCBCE620>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           │       │             └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x00000200CC7692A0>
           │       └ <attribute 'parent' of 'greenlet.greenlet' objects>
           └ <_AsyncIoGreenlet object at 0x00000200CE037640 (otid=0x00000200CB3BE0A0) dead>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
                  └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x00000200CC7692A0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x00000200CC53BA60>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000200CCBCE620>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ UndefinedFunctionError('оператор не существует: integer = character varying')
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000200CCBCE620>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
          │                     └ UndefinedFunctionError('оператор не существует: integer = character varying')
          └ ProgrammingError("<class 'asyncpg.exceptions.UndefinedFunctionError'>: оператор не существует: integer = character varying\nH...

sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.UndefinedFunctionError'>: оператор не существует: integer = character varying
HINT:  Оператор с данными именем и типами аргументов не найден. Возможно, вам следует добавить явные приведения типов.


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 344
               │     └ 3
               └ <function _main at 0x00000200C6BE96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 344
           │    └ <function BaseProcess._bootstrap at 0x00000200C6AD39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=16364 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000200C6AD2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=16364 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000200C902AFF0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=16364 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=16364 started>
    │    └ <function subprocess_started at 0x00000200C90328E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=16364 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=768, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000200C9178860>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=768, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x00000200C9031D00>
           │       │   └ <uvicorn.server.Server object at 0x00000200C9178860>
           │       └ <function run at 0x00000200C88731A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000200C9155000>
           │      └ <function Runner.run at 0x00000200C8920B80>
           └ <asyncio.runners.Runner object at 0x00000200C6B995B0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x00000200C891E7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x00000200C6B995B0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000200C891E700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000200C8920540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000200C885E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000200C91A4320>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000200CC...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x00000200CB193440>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000200C91A4320>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000200CC...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000200CC...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000200CC7A4EC0>
          └ <fastapi.applications.FastAPI object at 0x00000200CB193440>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000200CDE036A0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x00000200CC7A4E00>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000200CC7A4EC0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000200CDE036A0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x00000200CC757560>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x00000200CC7A4E00>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000200CDE03C40>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x00000200CCD0AF00>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000020...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x00000200CC757560>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x00000200CCD0AF00>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000200CDE03C40>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ ProgrammingError("(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000200CDE03420>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000200CDE03D80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x00000200CC7A51C0>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x00000200CC757560>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x00000200CA04CC20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ProgrammingError("(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x00000200CCC9EF60>
    └ <contextlib._GeneratorContextManager object at 0x00000200CCD0A840>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000200CDE039C0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x00000200CCD0A210>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x00000200CC7A51C0>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x00000200CC7A51C0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 58, in dispatch
    return await call_next(request)
                 │         └ <starlette.middleware.base._CachedRequest object at 0x00000200CCD0A210>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000200CDE039C0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ ProgrammingError("(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000200CDE03BA0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000200CDE03A60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000200CC7A4F50>
          └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x00000200CC7A51C0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000200CDE03BA0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000200CDE03A60>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x00000200CCD09F70>
          │                            │    └ <fastapi.routing.APIRouter object at 0x00000200CC778FB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000200CC7A4F50>
          └ <function wrap_app_handling_exceptions at 0x00000200CB1837E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000200CCBED120>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000200CDE03A60>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <fastapi.routing.APIRouter object at 0x00000200CC778FB0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000200CCBED120>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000200CDE03A60>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x00000200CC778FB0>>
          └ <fastapi.routing.APIRouter object at 0x00000200CC778FB0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000200CCBED120>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000200CDE03A60>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │     └ <function Route.handle at 0x00000200CB1A4E00>
          └ APIRoute(path='/auth/me', name='get_current_user', methods=['GET'])
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000200CCBED120>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000200CDE03A60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <function request_response.<locals>.app at 0x00000200CC749C60>
          └ APIRoute(path='/auth/me', name='get_current_user', methods=['GET'])
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000200CCBED120>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000200CDE03A60>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x00000200CDFD9790>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x00000200CCBECB80>
          └ <function wrap_app_handling_exceptions at 0x00000200CB1837E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000200CCBED4E0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000200CDE03A60>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x00000200CCBECB80>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x00000200CDFD9790>
                     └ <function get_request_handler.<locals>.app at 0x00000200CC74A520>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000200CB183060>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'session': <sqlalchemy.orm.session.AsyncSession object at 0x00000200CDFD93D0>, 'request': <starlette.requests.Request object...
                 │         └ <function get_current_user at 0x00000200CC74A0C0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[], dependencies=[Dependant(path_p...

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\routers\auth_router.py", line 72, in get_current_user
    user = await user_repo.get_by_id(user_id)
                 │         │         └ '2'
                 │         └ <function UserRepository.get_by_id at 0x00000200CBFBA700>
                 └ <src.db.repositories.user_repository.UserRepository object at 0x00000200CDFD9220>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\db\repositories\user_repository.py", line 26, in get_by_id
    result = await self.session.execute(q)
                   │    │       │       └ <sqlalchemy.sql.selectable.Select object at 0x00000200CDFDA0F0>
                   │    │       └ <function AsyncSession.execute at 0x00000200CBFA3880>
                   │    └ <sqlalchemy.orm.session.AsyncSession object at 0x00000200CDFD93D0>
                   └ <src.db.repositories.user_repository.UserRepository object at 0x00000200CDFD9220>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 461, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x00000200CB571260>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x00000200CE037640 (otid=0x00000200CB3BE0A0) dead>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2362, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x00000200CBECBCE0>
           └ <sqlalchemy.orm.session.Session object at 0x00000200CDFD9FA0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x00000200CBD60FE0>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x00000200CBB1E480>
             └ <sqlalchemy.engine.base.Connection object at 0x00000200CDFD9EB0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x00000200CDFDA0F0>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x00000200CBB1E7A0>
           └ <sqlalchemy.engine.base.Connection object at 0x00000200CDFD9EB0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x00000200CBB1E980>
          └ <sqlalchemy.engine.base.Connection object at 0x00000200CDFD9EB0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x00000200CBB1EA20>
           └ <sqlalchemy.engine.base.Connection object at 0x00000200CDFD9EB0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x00000200CBB1ECA0>
    └ <sqlalchemy.engine.base.Connection object at 0x00000200CDFD9EB0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ ProgrammingError("<class 'asyncpg.exceptions.UndefinedFunctionError'>: оператор не существует: integer = character varying\nH...
          │                    │              └ (<class 'sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError'>, ProgrammingError("<class 'asyncp...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError("(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x00000200CBBD18A0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x00000200CC065700>
    └ <sqlalchemy.engine.base.Connection object at 0x00000200CDFD9EB0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('2',)
    │      │       └ 'SELECT users.id, users.email, users.hashed_password, users.is_active, users.created_at, users.updated_at \nFROM users \nWHER...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x00000200CC53BC40>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000200CCBCE620>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000200CCBCE620>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           │       │             └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x00000200CC7692A0>
           │       └ <attribute 'parent' of 'greenlet.greenlet' objects>
           └ <_AsyncIoGreenlet object at 0x00000200CE037640 (otid=0x00000200CB3BE0A0) dead>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
                  └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x00000200CC7692A0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x00000200CC53BA60>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000200CCBCE620>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ UndefinedFunctionError('оператор не существует: integer = character varying')
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000200CCBCE620>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
          │                     └ UndefinedFunctionError('оператор не существует: integer = character varying')
          └ ProgrammingError("<class 'asyncpg.exceptions.UndefinedFunctionError'>: оператор не существует: integer = character varying\nH...

sqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: оператор не существует: integer = character varying
HINT:  Оператор с данными именем и типами аргументов не найден. Возможно, вам следует добавить явные приведения типов.
[SQL: SELECT users.id, users.email, users.hashed_password, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::VARCHAR]
[parameters: ('2',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2024-12-22 16:21:55 | INFO | src.db.repositories.session_repository:delete_session_by_token:49 - Session with refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwiZXhwIjoxNzM1NDYwNTA5fQ.fNR3Wkv3CzEFKQ85iQEk08jOoaq9cxtBZGJNUI4MFLE deleted successfully
2024-12-22 16:27:50 | INFO | src.app:on_shutdown:68 - Shutting down AuthService ...
2024-12-22 16:27:53 | INFO | src.integrations.logging_client:__init__:12 - LoggingClient initialized for service: AuthService
2024-12-22 16:27:53 | INFO | src.app:on_startup:57 - Starting AuthService ...
2024-12-22 16:27:53 | INFO | src.db.database:init_db:39 - Database connection is OK
2024-12-22 16:27:53 | INFO | src.app:on_startup:60 - Migrations applied successfully
2024-12-22 16:27:59 | INFO | src.app:on_shutdown:68 - Shutting down AuthService ...
2024-12-22 16:28:11 | INFO | src.integrations.logging_client:__init__:12 - LoggingClient initialized for service: AuthService
2024-12-22 16:28:11 | INFO | src.app:on_startup:57 - Starting AuthService ...
2024-12-22 16:28:11 | INFO | src.db.database:init_db:39 - Database connection is OK
2024-12-22 16:28:12 | INFO | src.app:on_startup:60 - Migrations applied successfully
2024-12-22 16:28:21 | INFO | src.db.repositories.session_repository:create_session:29 - Session created for user_id=2 with refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwiZXhwIjoxNzM1NDYwOTAxfQ.PneDfIthBPJ7Z6XiH5eXxanVFWv90GhQLWknesebqbA
2024-12-22 16:28:26 | DEBUG | src.api.middleware.auth_middleware:dispatch:50 - User authenticated: user_id=2, roles=[]
2024-12-22 16:28:26 | ERROR | src.api.middleware.error_handler:dispatch:20 - Unhandled exception
Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 510, in _prepare_and_execute
    prepared_stmt, attributes = await adapt_connection._prepare(
                                      │                └ <function AsyncAdapt_asyncpg_connection._prepare at 0x0000017AC8E5CF40>
                                      └ <AdaptedConnection <asyncpg.connection.Connection object at 0x0000017AC909A8A0>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 756, in _prepare
    prepared_stmt = await self._connection.prepare(
                          │    └ <member '_connection' of 'AdaptedConnection' objects>
                          └ <AdaptedConnection <asyncpg.connection.Connection object at 0x0000017AC909A8A0>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\asyncpg\connection.py", line 635, in prepare
    return await self._prepare(
                 │    └ <function Connection._prepare at 0x0000017AC9040540>
                 └ <asyncpg.connection.Connection object at 0x0000017AC909A8A0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\asyncpg\connection.py", line 653, in _prepare
    stmt = await self._get_statement(
                 │    └ <function Connection._get_statement at 0x0000017AC9040220>
                 └ <asyncpg.connection.Connection object at 0x0000017AC909A8A0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\asyncpg\connection.py", line 432, in _get_statement
    statement = await self._protocol.prepare(
                      │    └ <member '_protocol' of 'Connection' objects>
                      └ <asyncpg.connection.Connection object at 0x0000017AC909A8A0>
  File "asyncpg\\protocol\\protocol.pyx", line 165, in prepare
    return await waiter

asyncpg.exceptions.UndefinedFunctionError: оператор не существует: integer = character varying
HINT:  Оператор с данными именем и типами аргументов не найден. Возможно, вам следует добавить явные приведения типов.


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000017AC84CD8A0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x0000017AC8F42D80>
    └ <sqlalchemy.engine.base.Connection object at 0x0000017AC964A630>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('2',)
    │      │       └ 'SELECT users.id, users.email, users.hashed_password, users.is_active, users.created_at, users.updated_at \nFROM users \nWHER...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x0000017AC8E5C2C0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x0000017AC950E8C0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x0000017AC950E8C0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           │       │             └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x0000017AC9079690>
           │       └ <attribute 'parent' of 'greenlet.greenlet' objects>
           └ <_AsyncIoGreenlet object at 0x0000017AC968CC80 (otid=0x0000017AC7E91860) dead>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
                  └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x0000017AC9079690>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x0000017AC8E5C0E0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x0000017AC950E8C0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ UndefinedFunctionError('оператор не существует: integer = character varying')
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x0000017AC950E8C0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
          │                     └ UndefinedFunctionError('оператор не существует: integer = character varying')
          └ ProgrammingError("<class 'asyncpg.exceptions.UndefinedFunctionError'>: оператор не существует: integer = character varying\nH...

sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.UndefinedFunctionError'>: оператор не существует: integer = character varying
HINT:  Оператор с данными именем и типами аргументов не найден. Возможно, вам следует добавить явные приведения типов.


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 348
               │     └ 3
               └ <function _main at 0x0000017AC35B96C0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 348
           │    └ <function BaseProcess._bootstrap at 0x0000017AC34A39C0>
           └ <SpawnProcess name='SpawnProcess-1' parent=11380 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000017AC34A2F20>
    └ <SpawnProcess name='SpawnProcess-1' parent=11380 started>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000017AC598AFF0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=11380 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=11380 started>
    │    └ <function subprocess_started at 0x0000017AC59928E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=11380 started>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=400, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000017AC5AD8860>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=400, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x0000017AC5991D00>
           │       │   └ <uvicorn.server.Server object at 0x0000017AC5AD8860>
           │       └ <function run at 0x0000017AC51331A0>
           └ <module 'asyncio' from 'C:\\Users\\Oleg\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000017AC5AB5000>
           │      └ <function Runner.run at 0x0000017AC5280B80>
           └ <asyncio.runners.Runner object at 0x0000017AC35695B0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000017AC527E7A0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000017AC35695B0>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 673, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000017AC527E700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 640, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000017AC5280540>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py", line 1992, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000017AC511E7A0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000017AC5B04320>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017AC9...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000017AC5C54CB0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000017AC5B04320>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017AC9...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017AC9...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000017AC90BD610>
          └ <fastapi.applications.FastAPI object at 0x0000017AC5C54CB0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000017AC964E3E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000017AC90BD4F0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000017AC90BD610>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000017AC964E3E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000017AC90BD550>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000017AC90BD4F0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000017AC964E700>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000017AC94E9EE0>
                     │    └ <bound method ErrorHandlerMiddleware.dispatch of <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000017...
                     └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000017AC90BD550>

> File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\error_handler.py", line 14, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x0000017AC94E9EE0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000017AC964E700>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ ProgrammingError("(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000017AC908B920>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000017AC908B6A0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000017AC90BD6D0>
          └ <src.api.middleware.error_handler.ErrorHandlerMiddleware object at 0x0000017AC90BD550>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         └ <function collapse_excgroups at 0x0000017AC69ACC20>
  File "C:\Users\Oleg\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ProgrammingError("(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0x0000017AC94ECEE0>
    └ <contextlib._GeneratorContextManager object at 0x0000017AC95032C0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000017AC9535760>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000017AC9503620>
                     │    └ <bound method AuthMiddleware.dispatch of <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000017AC90BD6D0>>
                     └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000017AC90BD6D0>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\middleware\auth_middleware.py", line 58, in dispatch
    return await call_next(request)
                 │         └ <starlette.middleware.base._CachedRequest object at 0x0000017AC9503620>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000017AC9535760>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
          └ ProgrammingError("(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000017AC9534FE0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000017AC9535580>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000017AC90BD6A0>
          └ <src.api.middleware.auth_middleware.AuthMiddleware object at 0x0000017AC90BD6D0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000017AC9534FE0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000017AC9535580>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000017AC9503F50>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000017AC900FAA0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000017AC90BD6A0>
          └ <function wrap_app_handling_exceptions at 0x0000017AC7AE37E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000017AC95358A0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000017AC9535580>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000017AC900FAA0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000017AC95358A0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000017AC9535580>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000017AC900FAA0>>
          └ <fastapi.routing.APIRouter object at 0x0000017AC900FAA0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000017AC95358A0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000017AC9535580>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │     └ <function Route.handle at 0x0000017AC7B04E00>
          └ APIRoute(path='/auth/me', name='get_current_user', methods=['GET'])
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000017AC95358A0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000017AC9535580>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000017AC9062520>
          └ APIRoute(path='/auth/me', name='get_current_user', methods=['GET'])
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000017AC95358A0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000017AC9535580>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000017AC9648E00>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000017AC9535940>
          └ <function wrap_app_handling_exceptions at 0x0000017AC7AE37E0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000017AC9535A80>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000017AC9535580>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000017AC9535940>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000017AC9648E00>
                     └ <function get_request_handler.<locals>.app at 0x0000017AC9062CA0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000017AC7AE3060>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'session': <sqlalchemy.orm.session.AsyncSession object at 0x0000017AC964A210>, 'request': <starlette.requests.Request object...
                 │         └ <function get_current_user at 0x0000017AC9062700>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[], dependencies=[Dependant(path_p...

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\api\routers\auth_router.py", line 73, in get_current_user
    user = await user_repo.get_by_id(user_id)
                 │         │         └ '2'
                 │         └ <function UserRepository.get_by_id at 0x0000017AC88BA5C0>
                 └ <src.db.repositories.user_repository.UserRepository object at 0x0000017AC964A480>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\src\db\repositories\user_repository.py", line 30, in get_by_id
    result = await self.session.execute(q)
                   │    │       │       └ <sqlalchemy.sql.selectable.Select object at 0x0000017AC964A4E0>
                   │    │       └ <function AsyncSession.execute at 0x0000017AC88A3880>
                   │    └ <sqlalchemy.orm.session.AsyncSession object at 0x0000017AC964A210>
                   └ <src.db.repositories.user_repository.UserRepository object at 0x0000017AC964A480>

  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 461, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x0000017AC7ED1260>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x0000017AC968CC80 (otid=0x0000017AC7E91860) dead>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2362, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000017AC87CBCE0>
           └ <sqlalchemy.orm.session.Session object at 0x0000017AC964A4B0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x0000017AC8660FE0>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 305, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x0000017AC841E480>
             └ <sqlalchemy.engine.base.Connection object at 0x0000017AC964A630>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x0000017AC964A4E0>>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x0000017AC841E7A0>
           └ <sqlalchemy.engine.base.Connection object at 0x0000017AC964A630>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x0000017AC841E980>
          └ <sqlalchemy.engine.base.Connection object at 0x0000017AC964A630>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x0000017AC841EA20>
           └ <sqlalchemy.engine.base.Connection object at 0x0000017AC964A630>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x0000017AC841ECA0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000017AC964A630>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ ProgrammingError("<class 'asyncpg.exceptions.UndefinedFunctionError'>: оператор не существует: integer = character varying\nH...
          │                    │              └ (<class 'sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError'>, ProgrammingError("<class 'asyncp...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError("(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError...
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000017AC84CD8A0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x0000017AC8F42D80>
    └ <sqlalchemy.engine.base.Connection object at 0x0000017AC964A630>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ ('2',)
    │      │       └ 'SELECT users.id, users.email, users.hashed_password, users.is_active, users.created_at, users.updated_at \nFROM users \nWHER...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x0000017AC8E5C2C0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x0000017AC950E8C0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x0000017AC950E8C0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           │       │             └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x0000017AC9079690>
           │       └ <attribute 'parent' of 'greenlet.greenlet' objects>
           └ <_AsyncIoGreenlet object at 0x0000017AC968CC80 (otid=0x0000017AC7E91860) dead>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
                  └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x0000017AC9079690>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x0000017AC8E5C0E0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x0000017AC950E8C0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ UndefinedFunctionError('оператор не существует: integer = character varying')
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x0000017AC950E8C0>
  File "C:\Users\Oleg\Documents\GitHub\tg_lab\services\auth_service\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
          │                     └ UndefinedFunctionError('оператор не существует: integer = character varying')
          └ ProgrammingError("<class 'asyncpg.exceptions.UndefinedFunctionError'>: оператор не существует: integer = character varying\nH...

sqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: оператор не существует: integer = character varying
HINT:  Оператор с данными именем и типами аргументов не найден. Возможно, вам следует добавить явные приведения типов.
[SQL: SELECT users.id, users.email, users.hashed_password, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::VARCHAR]
[parameters: ('2',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2024-12-22 16:28:29 | DEBUG | src.api.middleware.auth_middleware:dispatch:50 - User authenticated: user_id=2, roles=[]
2024-12-22 16:28:29 | INFO | src.db.repositories.session_repository:delete_session_by_token:49 - Session with refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyIiwiZXhwIjoxNzM1NDYwOTAxfQ.PneDfIthBPJ7Z6XiH5eXxanVFWv90GhQLWknesebqbA deleted successfully
2024-12-22 16:29:20 | WARNING | src.api.middleware.auth_middleware:dispatch:52 - Authentication failed: Not authenticated
2024-12-22 16:29:25 | WARNING | src.api.middleware.auth_middleware:dispatch:52 - Authentication failed: Not authenticated
2024-12-22 16:32:17 | ERROR | src.api.middleware.auth_middleware:_verify_token:73 - JWT decoding error: Not enough segments
2024-12-22 16:32:17 | WARNING | src.api.middleware.auth_middleware:dispatch:52 - Authentication failed: Invalid token
2024-12-22 16:33:10 | INFO | src.app:on_shutdown:68 - Shutting down AuthService ...
2024-12-22 16:33:12 | INFO | src.integrations.logging_client:__init__:13 - LoggingClient initialized for service: AuthService
2024-12-22 16:33:12 | INFO | src.app:on_startup:57 - Starting AuthService ...
2024-12-22 16:33:12 | INFO | src.db.database:init_db:39 - Database connection is OK
2024-12-22 16:33:12 | INFO | src.app:on_startup:60 - Migrations applied successfully
2024-12-22 16:33:12 | INFO | src.app:on_shutdown:68 - Shutting down AuthService ...
2024-12-22 16:33:13 | INFO | src.integrations.logging_client:__init__:13 - LoggingClient initialized for service: AuthService
2024-12-22 16:33:13 | INFO | src.app:on_startup:57 - Starting AuthService ...
2024-12-22 16:33:13 | INFO | src.db.database:init_db:39 - Database connection is OK
2024-12-22 16:33:13 | INFO | src.app:on_startup:60 - Migrations applied successfully
2024-12-22 16:43:12 | INFO | src.app:on_shutdown:68 - Shutting down AuthService ...
2024-12-22 16:43:14 | INFO | src.integrations.logging_client:__init__:13 - LoggingClient initialized for service: AuthService
2024-12-22 16:43:14 | INFO | src.app:on_startup:57 - Starting AuthService ...
2024-12-22 16:43:14 | INFO | src.db.database:init_db:39 - Database connection is OK
2024-12-22 16:43:14 | INFO | src.app:on_startup:60 - Migrations applied successfully
2024-12-22 16:43:14 | INFO | src.app:on_shutdown:68 - Shutting down AuthService ...
2024-12-22 16:43:16 | INFO | src.integrations.logging_client:__init__:13 - LoggingClient initialized for service: AuthService
2024-12-22 16:43:16 | INFO | src.app:on_startup:57 - Starting AuthService ...
2024-12-22 16:43:16 | INFO | src.db.database:init_db:39 - Database connection is OK
2024-12-22 16:43:16 | INFO | src.app:on_startup:60 - Migrations applied successfully
2024-12-22 16:43:24 | INFO | src.app:on_shutdown:68 - Shutting down AuthService ...
2024-12-22 16:43:25 | INFO | src.integrations.logging_client:__init__:13 - LoggingClient initialized for service: AuthService
2024-12-22 16:43:25 | INFO | src.app:on_startup:95 - Starting AuthService...
2024-12-22 16:43:25 | INFO | src.app:on_startup:96 - Environment: development
2024-12-22 16:43:25 | INFO | src.app:on_startup:97 - Debug mode: True
2024-12-22 16:43:25 | INFO | src.db.database:init_db:39 - Database connection is OK
2024-12-22 16:43:25 | INFO | src.app:on_startup:101 - Database initialized successfully
2024-12-22 16:43:26 | INFO | src.app:on_startup:105 - Database migrations applied successfully
2024-12-22 16:43:26 | INFO | src.app:on_startup:107 - AuthService started successfully
2024-12-22 16:43:29 | INFO | src.app:on_shutdown:119 - Shutting down AuthService...
2024-12-22 16:43:29 | INFO | src.app:on_shutdown:121 - Database connection closed
2024-12-22 16:43:29 | INFO | src.app:on_shutdown:122 - AuthService shutdown completed
2024-12-22 16:43:44 | INFO | src.integrations.logging_client:__init__:13 - LoggingClient initialized for service: AuthService
2024-12-22 16:43:44 | INFO | src.app:on_startup:95 - Starting AuthService...
2024-12-22 16:43:44 | INFO | src.app:on_startup:96 - Environment: development
2024-12-22 16:43:44 | INFO | src.app:on_startup:97 - Debug mode: True
2024-12-22 16:43:44 | INFO | src.db.database:init_db:39 - Database connection is OK
2024-12-22 16:43:44 | INFO | src.app:on_startup:101 - Database initialized successfully
2024-12-22 16:43:44 | INFO | src.app:on_startup:105 - Database migrations applied successfully
2024-12-22 16:43:44 | INFO | src.app:on_startup:107 - AuthService started successfully
2024-12-22 16:43:53 | DEBUG | src.api.middleware.error_handler:dispatch:54 - Processing request: POST /auth/login
2024-12-22 16:43:53 | DEBUG | src.api.middleware.auth_middleware:dispatch:90 - Skipping auth for public path: /auth/login
2024-12-22 16:43:53 | WARNING | src.api.controllers.auth_controller:login_user:98 - Failed login attempt for user: testuser@example.com
2024-12-22 16:43:53 | WARNING | src.app:http_exception_handler:145 - HTTP 401 error for POST /auth/login: Invalid credentials
2024-12-22 16:43:53 | INFO | src.app:log_requests:83 - Method: POST Path: /auth/login Status: 401 Duration: 259.04ms
2024-12-22 16:45:18 | DEBUG | src.api.middleware.error_handler:dispatch:54 - Processing request: POST /auth/register
2024-12-22 16:45:18 | DEBUG | src.api.middleware.auth_middleware:dispatch:90 - Skipping auth for public path: /auth/register
2024-12-22 16:45:18 | WARNING | src.api.controllers.auth_controller:register_user:47 - Attempted to register existing email: testuser@example.com
2024-12-22 16:45:18 | WARNING | src.app:http_exception_handler:145 - HTTP 400 error for POST /auth/register: User with this email already exists
2024-12-22 16:45:18 | INFO | src.app:log_requests:83 - Method: POST Path: /auth/register Status: 400 Duration: 8.79ms
2024-12-22 16:48:42 | INFO | src.app:on_shutdown:119 - Shutting down AuthService...
2024-12-22 16:48:42 | INFO | src.app:on_shutdown:121 - Database connection closed
2024-12-22 16:48:42 | INFO | src.app:on_shutdown:122 - AuthService shutdown completed
